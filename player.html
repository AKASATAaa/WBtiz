<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선수정보 - WBD 기록실</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }
        
        .header {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
            padding: 0;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #ff4757, #ff3742);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .language-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .language-btn {
            padding: 6px 12px;
            border: 1px solid #e9ecef;
            background-color: white;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .language-btn:hover {
            border-color: #ff4757;
            color: #ff4757;
        }
        
        .language-btn.active {
            background-color: #ff4757;
            color: white;
            border-color: #ff4757;
        }
        
        .search-icon, .user-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-icon svg, .user-icon svg {
            width: 20px;
            height: 20px;
            fill: #666;
        }
        
        .user-icon {
            background-color: #ff4757;
            border-radius: 50%;
        }
        
        .user-icon svg {
            fill: white;
        }
        
        .nav-container {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
        }
        
        .nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            padding: 0 20px;
        }
        
        .nav-item {
            padding: 16px 20px;
            color: #666;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            color: #333;
            border-bottom-color: #ff4757;
        }
        
        .nav-item.active {
            color: #333;
            border-bottom-color: #ff4757;
        }

        .main-content {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 20px 0;
        }

        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
        }

        .search-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #ff4757;
        }

        .stats-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stats-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .player-count {
            color: #666;
            font-size: 14px;
        }

        .player-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .player-table th {
            background-color: #f8f9fa;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e9ecef;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .player-table th:hover {
            background-color: #e9ecef;
        }

        .player-table th.sortable::after {
            content: '↕';
            margin-left: 8px;
            color: #999;
            font-size: 12px;
        }

        .player-table th.sort-asc::after {
            content: '↑';
            color: #ff4757;
        }

        .player-table th.sort-desc::after {
            content: '↓';
            color: #ff4757;
        }

        .player-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            color: #333;
        }

        .player-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .player-name {
            font-weight: 500;
            color: #333;
            text-align: center;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .player-name:hover {
            color: #ff4757;
        }

        .player-detail-row {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .player-detail-cell {
            padding: 20px;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .detail-panel {
            display: flex;
            gap: 10px;
            padding: 15px;
            flex-wrap: wrap;
        }

        .detail-left, .detail-center, .detail-right {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            min-height: 200px;
            min-width: 250px;
        }

        .detail-bottom {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            min-height: 200px;
            min-width: 250px;
        }

        /* 투구정보와 히트스프레이를 각각 한 줄 전체로 표시 */
        .detail-bottom.full-width {
            flex: 1 1 100%;
            min-width: 100%;
        }

        .detail-panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #ff4757;
            padding-bottom: 10px;
        }

        .detail-content {
            color: #666;
            font-size: 15px;
            line-height: 1.8;
        }

        .detail-content p {
            margin-bottom: 12px;
        }

        .player-profile {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .player-photo {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background-color: #f0f0f0;
            border: 3px solid #ff4757;
            margin: 60px auto 30px;
            position: relative;
            overflow: hidden;
        }

        .player-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .player-photo span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            color: #999;
            font-weight: bold;
            text-align: center;
            line-height: 1;
            margin: 0;
            padding: 0;
            width: auto;
            height: auto;
        }

        .player-name-large {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .player-name-english {
            font-size: 18px;
            color: #666;
            font-style: italic;
        }

        .stat-item {
            margin-bottom: 15px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-percentage {
            font-size: 12px;
            font-weight: 600;
            color: #ff4757;
            background-color: #fff;
            border: 2px solid #ff4757;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-bar {
            width: 100%;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            position: relative;
            overflow: visible;
            cursor: pointer;
        }

        .stat-tooltip {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .stat-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
        }

        .stat-bar:hover .stat-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ff3742);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .stat-scale {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #999;
            margin-top: 5px;
        }

        .team-name {
            color: #666;
            font-size: 14px;
        }

        .league-name {
            color: #999;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background-color: #fee;
            color: #c33;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #fcc;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .content-container {
                padding: 0 12px;
            }
            
            .player-table {
                font-size: 14px;
            }
            
            .player-table th,
            .player-table td {
                padding: 8px 12px;
            }
        }

        /* 투구 정보 스타일 */
        .pitching-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .pitching-stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .pitching-stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .pitching-stat-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .pitch-types {
            border-top: 1px solid #e9ecef;
            padding-top: 15px;
        }

        .pitch-types h4 {
            font-size: 14px;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .pitch-type-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .pitch-name {
            font-weight: 500;
            color: #333;
        }

        .pitch-speed {
            font-weight: 600;
            color: #ff4757;
        }

        /* 히트스프레이 스타일 */
        .spray-chart-container {
            text-align: center;
        }

        .spray-chart {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: white;
            margin-bottom: 15px;
        }

        .spray-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .spray-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .spray-stat-item .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .spray-stat-item .stat-value {
            font-size: 12px;
            color: #ff4757;
            font-weight: 600;
        }

        /* Placeholder 스타일 */
        .pitching-info-placeholder,
        .hit-spray-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 150px;
            color: #999;
            font-size: 16px;
            font-style: italic;
            background: #f8f9fa;
            border: 2px dashed #e9ecef;
            border-radius: 8px;
        }

        /* 투구정보 스타일 */
        .pitching-info-content {
            padding: 15px 0;
        }

        .pitch-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .pitch-type-controls {
            flex: 0 0 500px; /* 카드 너비 - 이 값을 조절하면 카드 너비가 바뀝니다 */
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px; /* 카드 내부 여백 - 이 값을 조절하면 내부 공간이 바뀝니다 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            /* 카드 높이를 조절하려면 아래 속성 추가:
            min-height: 400px; 
            max-height: 600px; */
        }

        .pitch-type-controls h4 {
            font-size: 16px; /* 제목 글자 크기 - 이 값을 조절하면 제목 크기가 바뀝니다 */
            font-weight: 600;
            color: #333;
            margin-bottom: 15px; /* 제목 아래 여백 - 이 값을 조절하면 제목과 버튼 사이 간격이 바뀝니다 */
            text-align: center;
            border-bottom: 2px solid #ff4757;
            padding-bottom: 10px;
        }

        .pitch-type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2열 배치 - 1fr 1fr 1fr로 하면 3열, 1fr로 하면 1열 */
            gap: 10px; /* 버튼 사이 간격 - 이 값을 조절하면 버튼 간격이 바뀝니다 */
        }

        .pitch-type-button {
            padding: 8px 12px; /* 버튼 내부 여백 - 이 값을 조절하면 버튼 크기가 바뀝니다 */
            background-color: #fff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: auto; /* 버튼 최소 높이 - 이 값을 조절하면 버튼 높이가 바뀝니다 */
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            font-size: 14px; /* 버튼 글자 크기 - 이 값을 조절하면 버튼 텍스트 크기가 바뀝니다 */
        }

        .pitch-type-button:hover {
            background-color: #f0f0f0;
        }

        .pitch-type-button.active {
            background-color: #ff4757;
            color: white;
            border-color: #ff4757;
        }

        .pitch-type-button.active .stat-label {
            color: white;
        }

        .pitch-type-button.active .stat-percentage {
            background-color: #fff;
            border: 2px solid white;
        }

        .pitch-type-button.active .stat-bar .stat-fill {
            background: linear-gradient(90deg, white, #fff);
        }

        .pitch-type-button.active .stat-bar .stat-tooltip {
            background-color: white;
            color: #333;
        }

        .pitch-type-button.active .stat-bar .stat-tooltip::after {
            border-top-color: white;
        }

        .pitch-type-button.active .stat-bar:hover .stat-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .pitch-type-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 0;
        }

        .pitch-type-name {
            font-weight: 600;
            font-size: 14px;
        }

        .pitch-count {
            font-size: 12px;
            color: #666;
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .pitch-type-button.active .pitch-count {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .pitch-type-stats {
            display: none;
        }

        .no-data {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
        }

        .pitch-zone-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .pitch-zone {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 10px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background-color: #f0f0f0;
            overflow: hidden;
        }

        .strike-zone-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-47%, -47%);
            width: 200px;
            height: 200px;
            border: 2px solid #495057;
            background: rgba(108, 117, 125, 0.05);
            border-radius: 2px;
        }

        .home-plate {
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 20px solid #6c757d;
            border-radius: 3px;
        }

        
        .pitch-zone-info {
            text-align: center;
            color: #666;
            font-size: 12px;
        }

        /* 투구 점 스타일 */
        .pitch-dot {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #fff;
            cursor: default;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-left: -6px;
            margin-top: -6px;
            pointer-events: none;
            z-index: 3;
        }

        .pitch-dot:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* Tracker.html과 동일한 투구 구역 스타일 */
        .strike-zone-container {
            flex: 1;
            min-width: 500px;
            max-width: 700px;
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .strike-zone {
            width: 500px;
            height: 500px;
            background: #f8f9fa;
            border: 2px solid #6c757d;
            border-radius: 4px;
            position: relative;
            margin: 0 auto;
            cursor: crosshair;
            box-sizing: border-box;
        }

        /* 히트스프레이 스타일 */
        .hit-spray-content {
            padding: 15px 0;
        }

        .hit-spray-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .field-container {
            flex: 1;
            min-width: 500px;
            max-width: 700px;
            background: #ffffff;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .field-container h4 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #ff4757;
            padding-bottom: 10px;
        }

        .baseball-field {
            width: 500px;
            height: 500px;
            background-image: url('SprayBG.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid #6c757d;
            border-radius: 4px;
            position: relative;
            margin: 0 auto;
            cursor: crosshair;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* 이미지 로드 실패 시 기본 야구장 배경 */
        .baseball-field::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #68d391 0%, #48bb78 100%);
            z-index: -1;
        }

        /* 기본 야구장 요소들 */
        .baseball-field::after {
            display: none; /* 중간의 갈색 다이아몬드 제거 */
        }

        .field-info {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #666;
            z-index: 2;
        }

        .hit-type-controls {
            flex: 0 0 500px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        .hit-type-controls h4 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #ff4757;
            padding-bottom: 10px;
        }

        .hit-type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .hit-type-button {
            padding: 8px 12px;
            background-color: #fff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
            min-height: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .hit-type-button:hover {
            background-color: #f0f0f0;
        }

        .hit-type-button.active {
            background-color: #ff4757;
            color: white;
            border-color: #ff4757;
        }

        .hit-type-button.active .hit-count {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .hit-type-name {
            font-weight: 600;
            font-size: 14px;
        }

        .hit-count {
            font-size: 12px;
            color: #666;
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 10px;
        }

        /* 타구 점 스타일 - 각 타구별로 다른 색상 적용 */
        .hit-marker {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #fff;
            cursor: default;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            margin-left: -6px;
            margin-top: -6px;
            pointer-events: none;
            z-index: 3;
            background-color: #999 !important; /* 기본 색상 (회색) - 최고 우선순위 */
        }

        .hit-marker:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* 1루타, 2루타, 3루타, 홈런 각각 다른 색상 - 최고 우선순위 */
        .hit-marker.single { 
            background-color: #48bb78 !important;      /* 1루타: 초록색 */
        }
        .hit-marker.double { 
            background-color: #4299e1 !important;      /* 2루타: 파란색 */
        }
        .hit-marker.triple { 
            background-color: #9f7aea !important;      /* 3루타: 보라색 */
        }
        .hit-marker.homerun { 
            background-color: #f56565 !important;     /* 홈런: 빨간색 */
        }

        /* 한국어 타구 타입도 지원 */
        .hit-marker.\31루타 { 
            background-color: #48bb78 !important;      /* 1루타: 초록색 */
        }
        .hit-marker.\32루타 { 
            background-color: #4299e1 !important;      /* 2루타: 파란색 */
        }
        .hit-marker.\33루타 { 
            background-color: #9f7aea !important;      /* 3루타: 보라색 */
        }
        .hit-marker.홈런 { 
            background-color: #f56565 !important;     /* 홈런: 빨간색 */
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="/" class="logo">
                <div class="logo-icon">W</div>
                <span class="logo-text">WBD 기록실</span>
            </a>
            <div class="header-actions">
                <div class="language-selector">
                    <button class="language-btn active" data-lang="ko">한국어</button>
                    <button class="language-btn" data-lang="ja">日本語</button>
                </div>
            </div>
        </div>
    </header>
    
    <nav class="nav-container">
        <div class="nav">
            <a href="record_bat_basic.html" class="nav-item">기록실</a>
            <a href="season.html" class="nav-item">시즌정보</a>
            <a href="team.html" class="nav-item">팀정보</a>
            <a href="player.html" class="nav-item active">선수정보</a>
            <a href="schedule.html" class="nav-item">경기일정</a>
        </div>
    </nav>

    <main class="main-content">
        <div class="content-container">
            <h1 class="page-title">선수정보</h1>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="선수명을 입력하세요..." id="searchInput">
            </div>
            
            <div class="stats-container">
                <div class="stats-header">
                    <h2 class="stats-title">전체 선수 목록</h2>
                    <span class="player-count" id="playerCount">총 0명</span>
                </div>
                
                <div id="playerTableContainer">
                    <div class="loading">선수 데이터를 불러오는 중...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let allPlayers = [];
        let filteredPlayers = [];
        let currentSortColumn = '이름';
        let currentSortDirection = 'asc';
        let expandedPlayers = new Set(); // 확장된 선수들을 추적

        // Excel 파일에서 선수 데이터를 로드하는 함수
        async function loadPlayerData() {
            try {
                // PlayerStatsLeague 파일 로드
                const response = await fetch('./Data/PlayerStatsLeague.xlsx');
                if (!response.ok) {
                    throw new Error('PlayerStatsLeague 파일을 불러올 수 없습니다');
                }

                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                console.log('PlayerStatsLeague 파일의 모든 시트:', workbook.SheetNames);
                
                // League_Team 파일 로드
                const teamResponse = await fetch('./Data/League_Team.xlsx');
                if (!teamResponse.ok) {
                    throw new Error('League_Team 파일을 불러올 수 없습니다');
                }

                const teamArrayBuffer = await teamResponse.arrayBuffer();
                const teamWorkbook = XLSX.read(teamArrayBuffer, { type: 'array' });
                
                console.log('League_Team 파일의 모든 시트:', teamWorkbook.SheetNames);
                
                const allPlayerData = [];
                
                // 각 시트(리그)의 선수 통계를 파싱
                workbook.SheetNames.forEach(sheetName => {
                    if (sheetName !== '~$PlayerStatsLeague') { // 임시 파일 제외
                        console.log(`시트 "${sheetName}" 처리 중...`);
                        
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        if (jsonData.length < 2) return; // 헤더만 있는 경우 스킵
                        
                        const headers = jsonData[0];
                        const players = [];
                        
                        // 1행부터 데이터 파싱 (0행은 헤더)
                        for (let rowIndex = 1; rowIndex < jsonData.length; rowIndex++) {
                            const row = jsonData[rowIndex];
                            if (row.length === 0) continue;
                            
                            const playerData = {};
                            headers.forEach((header, index) => {
                                playerData[header] = row[index] || '';
                            });
                            
                            // 이름 필드가 있으면 선수로 추가
                            if (playerData.이름 && playerData.이름.trim()) {
                                // 백분위 관련 컬럼 찾기
                                const percentileColumns = headers.filter(header => 
                                    header && (header.includes('%') || header.includes('퍼센트') || header.includes('백분위'))
                                );
                                
                                // 백분위 데이터를 선수 데이터에 추가
                                percentileColumns.forEach(column => {
                                    const columnIndex = headers.indexOf(column);
                                    const value = row[columnIndex];
                                    if (value !== undefined && value !== null && value !== '') {
                                        // 백분위 값 정규화 (0-100 범위)
                                        let normalizedValue = parseFloat(value);
                                        if (!isNaN(normalizedValue)) {
                                            if (normalizedValue > 1) {
                                                // 이미 백분위 값인 경우
                                                playerData[column] = Math.min(Math.max(normalizedValue, 0), 100);
                                            } else {
                                                // 소수점 값인 경우 백분위로 변환
                                                playerData[column] = Math.min(Math.max(normalizedValue * 100, 0), 100);
                                            }
                                        }
                                    }
                                });
                                
                                // PlayerStatsLeague에서 선수의 "리그" 컬럼 값을 읽어와서 League_Team에서 같은 이름의 시트 찾기
                                const playerLeague = playerData.리그;
                                console.log(`선수 "${playerData.이름}"의 리그: "${playerLeague}"`);
                                
                                if (playerLeague && teamWorkbook.SheetNames.includes(playerLeague)) {
                                    console.log(`League_Team에서 시트 "${playerLeague}" 찾음`);
                                    
                                    // 해당 시트에서 팀 정보 파싱
                                    const teamSheet = teamWorkbook.Sheets[playerLeague];
                                    const teamJsonData = XLSX.utils.sheet_to_json(teamSheet, { header: 1 });
                                    
                                    if (teamJsonData.length >= 3) {
                                        // 1열(A열)은 헤더, 2열(B열)부터: 팀명, 3열(C열)부터: 줄임말, 4열(D열)부터: 팀원들
                                        const teamNames = teamJsonData[0]; // 1행의 팀명들 (B열부터)
                                        const abbreviations = teamJsonData[1]; // 2행의 줄임말들 (B열부터)
                                        
                                        // 각 팀별로 정보 구성 (B열부터 시작)
                                        for (let colIndex = 1; colIndex < teamNames.length; colIndex++) {
                                            const teamName = teamNames[colIndex];
                                            if (!teamName || !teamName.trim()) continue;
                                            
                                            const abbreviation = abbreviations[colIndex] || '';
                                            const teamMembers = [];
                                            
                                            // 3행부터 팀원들 수집 (B열부터)
                                            for (let rowIndex = 2; rowIndex < teamJsonData.length; rowIndex++) {
                                                const memberName = teamJsonData[rowIndex][colIndex];
                                                if (memberName && memberName.trim()) {
                                                    teamMembers.push(memberName.trim());
                                                }
                                            }
                                            
                                            // 선수가 이 팀에 속하는지 확인
                                            const isMember = teamMembers.some(member => 
                                                member === playerData.이름 || 
                                                member === playerData.선수명
                                            );
                                            
                                            if (isMember) {
                                                playerData.팀 = teamName; // 팀명을 팀 컬럼에 저장
                                                console.log(`선수 "${playerData.이름}"을 팀 "${teamName}"에서 찾음`);
                                                break; // 첫 번째 매칭되는 팀을 찾으면 중단
                                            }
                                        }
                                    }
                                } else {
                                    console.log(`League_Team에서 시트 "${playerLeague}"을 찾을 수 없음`);
                                }
                                
                                players.push(playerData);
                                console.log(`선수 추가: "${playerData.이름}" (팀: ${playerData.팀})`, playerData);
                            }
                        }
                        
                        allPlayerData.push(...players);
                        console.log(`시트 "${sheetName}"의 선수 데이터 (${players.length}명):`, players.slice(0, 3));
                    }
                });
                
                // 중복 제거 (이름 기준)
                const uniquePlayers = [];
                const seenNames = new Set();
                
                allPlayerData.forEach(player => {
                    const playerName = player.이름.trim();
                    if (!seenNames.has(playerName)) {
                        seenNames.add(playerName);
                        uniquePlayers.push(player);
                    }
                });
                
                allPlayers = uniquePlayers;
                filteredPlayers = [...allPlayers];
                
                console.log('전체 선수 데이터:', allPlayers);
                console.log('중복 제거 후 선수 수:', allPlayers.length);
                
                renderPlayerTable();
                updatePlayerCount();
                
            } catch (error) {
                console.error('선수 데이터 로딩 실패:', error);
                document.getElementById('playerTableContainer').innerHTML = 
                    '<div class="error">선수 데이터를 불러오는데 실패했습니다. 다시 시도해주세요.</div>';
            }
        }

        // 선수 테이블 렌더링
        function renderPlayerTable() {
            const container = document.getElementById('playerTableContainer');
            
            if (filteredPlayers.length === 0) {
                container.innerHTML = '<div class="loading">검색 결과가 없습니다.</div>';
                return;
            }
            
            let tableRows = '';
            
            filteredPlayers.forEach(player => {
                // 선수 행
                tableRows += `
                    <tr>
                        <td class="player-name" onclick="togglePlayerDetail('${player.이름}')">${player.이름 || 'N/A'}</td>
                        <td class="team-name">${player.팀 || 'N/A'}</td>
                    </tr>
                `;
                
                // 확장된 선수의 상세 정보 행
                if (expandedPlayers.has(player.이름)) {
                    tableRows += `
                        <tr class="player-detail-row">
                            <td colspan="2" class="player-detail-cell">
                                <div class="detail-panel">
                                    <div class="detail-left">
                                        <div class="detail-panel-title">기본 정보</div>
                                        <div class="detail-content">
                                            <div class="player-profile">
                                                <div class="player-photo">
                                                    ${getPlayerProfileImage(player.이름) ? 
                                                        `<img src="${getPlayerProfileImage(player.이름)}" alt="${player.이름}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">` :
                                                        `<span>${player.이름 ? player.이름.charAt(0) : '?'}</span>`
                                                    }
                                                </div>
                                                <div class="player-name-large">${player.이름 || 'N/A'}</div>
                                                <div class="player-name-english">${player.영문이름 || ''}</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detail-center">
                                        <div class="detail-panel-title">투수 통계</div>
                                        <div class="detail-content" id="pitcher-stats-${player.이름}">
                                            <div class="loading">투수 통계를 불러오는 중...</div>
                                        </div>
                                    </div>
                                    <div class="detail-right">
                                        <div class="detail-panel-title">타자 통계</div>
                                        <div class="detail-content" id="batter-stats-${player.이름}">
                                            <div class="loading">타자 통계를 불러오는 중...</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="detail-panel">
                                    <div class="detail-bottom">
                                        <div class="detail-panel-title">투구 정보</div>
                                        <div class="detail-content" id="pitching-info-${player.이름}">
                                            <div class="loading">투구 정보를 불러오는 중...</div>
                                        </div>
                                    </div>
                                    <div class="detail-bottom full-width">
                                        <div class="detail-panel-title">히트스프레이</div>
                                        <div class="detail-content" id="hit-spray-${player.이름}">
                                            <div class="loading">히트스프레이를 불러오는 중...</div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                }
            });
            
            const table = `
                <table class="player-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="이름">선수명</th>
                            <th class="sortable" data-sort="팀">팀</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = table;
            
            // 정렬 이벤트 리스너 추가
            document.querySelectorAll('.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.sort;
                    if (currentSortColumn === column) {
                        currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSortColumn = column;
                        currentSortDirection = 'asc';
                    }
                    
                    sortPlayers();
                    renderPlayerTable();
                });
            });
        }

        // 선수 정렬
        function sortPlayers() {
            filteredPlayers.sort((a, b) => {
                let aValue = a[currentSortColumn] || '';
                let bValue = b[currentSortColumn] || '';
                
                // 숫자 정렬
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    aValue = parseFloat(aValue) || 0;
                    bValue = parseFloat(bValue) || 0;
                } else {
                    // 문자열 정렬
                    aValue = String(aValue).toLowerCase();
                    bValue = String(bValue).toLowerCase();
                }
                
                if (currentSortDirection === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
        }

        // 검색 기능
        function filterPlayers(searchTerm) {
            if (!searchTerm.trim()) {
                filteredPlayers = [...allPlayers];
            } else {
                filteredPlayers = allPlayers.filter(player => 
                    player.이름 && player.이름.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    player.팀 && player.팀.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            renderPlayerTable();
            updatePlayerCount();
        }

        // 선수 수 업데이트
        function updatePlayerCount() {
            const countElement = document.getElementById('playerCount');
            countElement.textContent = `총 ${filteredPlayers.length}명`;
        }

        // 검색 입력 이벤트
        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterPlayers(e.target.value);
        });

        // 선수 이름 클릭 시 상세 정보 토글
        function togglePlayerDetail(playerName) {
            // 다른 선수가 열려있으면 닫기
            if (expandedPlayers.size > 0 && !expandedPlayers.has(playerName)) {
                expandedPlayers.clear();
            }
            
            // 현재 선수 토글
            if (expandedPlayers.has(playerName)) {
                expandedPlayers.delete(playerName);
            } else {
                expandedPlayers.add(playerName);
            }
            
            renderPlayerTable();
            
            // 상세 정보가 열릴 때 해당 선수의 통계 데이터 로드
            if (expandedPlayers.has(playerName)) {
                loadPlayerStats(playerName);
            }
        }

        // 선수의 통계 데이터를 로드하고 차트 생성
        function loadPlayerStats(playerName) {
            const pitcherStatsContainer = document.getElementById(`pitcher-stats-${playerName}`);
            if (!pitcherStatsContainer) return;
            
            // 해당 선수의 데이터 찾기
            const playerData = allPlayers.find(player => player.이름 === playerName);
            if (!playerData) {
                pitcherStatsContainer.innerHTML = '<div class="error">선수 데이터를 찾을 수 없습니다.</div>';
                return;
            }
            
            // 투수 통계 생성 (실제 데이터가 있으면 사용, 없으면 기본값)
            const pitcherStats = generatePitcherStats(playerData);
            pitcherStatsContainer.innerHTML = pitcherStats;

            const batterStatsContainer = document.getElementById(`batter-stats-${playerName}`);
            if (!batterStatsContainer) return;

            // 타자 통계 생성 (실제 데이터가 있으면 사용, 없으면 기본값)
            const batterStats = generateBatterStats(playerData);
            batterStatsContainer.innerHTML = batterStats;

            // 투구 정보 생성
            const pitchingInfoContainer = document.getElementById(`pitching-info-${playerName}`);
            if (pitchingInfoContainer) {
                const pitchingInfo = generatePitchingInfo(playerData);
                pitchingInfoContainer.innerHTML = pitchingInfo;
                // 투구 미리보기 로드
                renderPitchZone(playerName);
            }

            // 히트스프레이 생성
            const hitSprayContainer = document.getElementById(`hit-spray-${playerName}`);
            if (hitSprayContainer) {
                const hitSpray = generateHitSpray(playerData);
                hitSprayContainer.innerHTML = hitSpray;
                // 히트스프레이 데이터 로드
                loadHitSprayData(playerName);
            }
        }

        // 선수 이름에 해당하는 프로필 사진 경로 생성
        function getPlayerProfileImage(playerName) {
            if (!playerName) return null;
            
            // 선수 이름에 .png를 바로 붙여서 경로 생성
            return `./Image/PlayerProfile/${playerName}.png`;
        }

        // 투수 통계 HTML 생성
        function generatePitcherStats(playerData) {
            // 투수 핵심 통계 지표들
            const pitcherStats = [
                { name: 'WHIP', key: 'WHIP', value: playerData.WHIP || 0 },
                { name: 'ERA', key: 'ERA', value: playerData.ERA || 0 },
                { name: 'AVG', key: 'AVG', value: playerData.AVG || 0 },
                { name: 'OBP', key: 'OBP', value: playerData.OBP || 0 },
                { name: 'K9', key: 'K9', value: playerData.K9 || 0 }
            ];
            
            // 백분위 계산을 위해 전체 선수들의 해당 통계 수집
            const allStats = {};
            pitcherStats.forEach(stat => {
                allStats[stat.key] = [];
            });
            
            // 모든 선수에서 해당 통계 수집
            allPlayers.forEach(player => {
                pitcherStats.forEach(stat => {
                    const value = player[stat.key];
                    if (value !== undefined && value !== null && value !== '' && !isNaN(parseFloat(value))) {
                        allStats[stat.key].push(parseFloat(value));
                    }
                });
            });
            
            // 각 통계의 백분위 계산
            const finalStats = pitcherStats.map(stat => {
                const values = allStats[stat.key];
                if (values.length === 0) {
                    return { ...stat, percentile: 50 }; // 데이터가 없으면 중간값
                }
                
                // 값 정렬 (K9은 높을수록 좋음, WHIP, ERA, AVG, OBP는 낮을수록 좋음)
                values.sort((a, b) => {
                    if (stat.key === 'K9') {
                        return b - a; // 내림차순 (높을수록 좋음)
                    } else {
                        return a - b; // 오름차순 (낮을수록 좋음)
                    }
                });
                
                // 백분위 계산
                const currentValue = parseFloat(stat.value) || 0;
                let betterCount = 0;
                
                if (stat.key === 'K9') {
                    // 높을수록 좋은 지표
                    betterCount = values.filter(v => v > currentValue).length;
                } else {
                    // 낮을수록 좋은 지표
                    betterCount = values.filter(v => v < currentValue).length;
                }
                
                const percentile = Math.round((betterCount / values.length) * 100);
                return { ...stat, percentile: Math.min(Math.max(percentile, 0), 100) };
            });
            
            let statsHTML = '';
            finalStats.forEach(stat => {
                const formattedValue = parseFloat(stat.value).toFixed(2);
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-label">
                            <span>${stat.name}</span>
                            <div class="stat-percentage">${stat.percentile}</div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill" style="width: ${stat.percentile}%"></div>
                            <div class="stat-tooltip">
                                ${stat.name}: ${formattedValue}
                            </div>
                        </div>
                        <div class="stat-scale">
                            <span>Poor</span>
                            <span>Avg</span>
                            <span>Great</span>
                        </div>
                    </div>
                `;
            });
            
            return statsHTML;
        }

        // 타자 통계 HTML 생성
        function generateBatterStats(playerData) {
            // 타자 핵심 통계 지표들
            const batterStats = [
                { name: 'AVG', key: 'AVG', value: playerData.AVG || 0 },
                { name: 'OPS', key: 'OPS', value: playerData.OPS || 0 },
                { name: 'wRC+', key: 'wRC+', value: playerData['wRC+'] || 0 },
                { name: 'SLG', key: 'SLG', value: playerData.SLG || 0 },
                { name: 'H', key: 'H', value: playerData.H || 0 }
            ];
            
            // 백분위 계산을 위해 전체 선수들의 해당 통계 수집
            const allStats = {};
            batterStats.forEach(stat => {
                allStats[stat.key] = [];
            });
            
            // 모든 선수에서 해당 통계 수집
            allPlayers.forEach(player => {
                batterStats.forEach(stat => {
                    const value = player[stat.key];
                    if (value !== undefined && value !== null && value !== '' && !isNaN(parseFloat(value))) {
                        allStats[stat.key].push(parseFloat(value));
                    }
                });
            });
            
            // 각 통계의 백분위 계산
            const finalStats = batterStats.map(stat => {
                const values = allStats[stat.key];
                if (values.length === 0) {
                    return { ...stat, percentile: 50 }; // 데이터가 없으면 중간값
                }
                
                // 값 정렬 (AVG, OPS, wRC+, SLG는 높을수록 좋음, H는 낮을수록 좋음)
                values.sort((a, b) => {
                    if (stat.key === 'AVG' || stat.key === 'OPS' || stat.key === 'wRC+' || stat.key === 'SLG') {
                        return b - a; // 내림차순 (높을수록 좋음)
                    } else {
                        return a - b; // 오름차순 (낮을수록 좋음)
                    }
                });
                
                // 백분위 계산
                const currentValue = parseFloat(stat.value) || 0;
                let betterCount = 0;
                
                if (stat.key === 'AVG' || stat.key === 'OPS' || stat.key === 'wRC+' || stat.key === 'SLG') {
                    // 높을수록 좋은 지표
                    betterCount = values.filter(v => v > currentValue).length;
                } else {
                    // 낮을수록 좋은 지표
                    betterCount = values.filter(v => v < currentValue).length;
                }
                
                const percentile = Math.round((betterCount / values.length) * 100);
                return { ...stat, percentile: Math.min(Math.max(percentile, 0), 100) };
            });
            
            let statsHTML = '';
            finalStats.forEach(stat => {
                const formattedValue = parseFloat(stat.value).toFixed(2);
                statsHTML += `
                    <div class="stat-item">
                        <div class="stat-label">
                            <span>${stat.name}</span>
                            <div class="stat-percentage">${stat.percentile}</div>
                        </div>
                        <div class="stat-bar">
                            <div class="stat-fill" style="width: ${stat.percentile}%"></div>
                            <div class="stat-tooltip">
                                ${stat.name}: ${formattedValue}
                            </div>
                        </div>
                        <div class="stat-scale">
                            <span>Poor</span>
                            <span>Avg</span>
                            <span>Great</span>
                        </div>
                    </div>
                `;
            });
            
            return statsHTML;
        }

        // 투구 정보 HTML 생성
        function generatePitchingInfo(playerData) {
            // Tracker.html과 동일한 투구 구역 HTML 생성
            return `
                <div class="pitching-info-content">
                    <div class="pitch-layout">
                        <div class="strike-zone-container">
                            <h4>투구 구역</h4>
                            <div class="strike-zone" id="strike-zone-${playerData.이름}">
                                <div class="strike-zone-box"></div>
                            </div>
                            <div class="pitch-zone-info">
                                <small>PitchTrack 폴더의 JSON 파일에서 투구 위치를 점으로 표시합니다.</small>
                            </div>
                        </div>
                        <div class="pitch-type-controls">
                            <h4>구종별 보기</h4>
                            <div class="pitch-type-buttons" id="pitch-type-buttons-${playerData.이름}">
                                <div class="loading">구종 데이터를 불러오는 중...</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 히트스프레이 HTML 생성
        function generateHitSpray(playerData) {
            // Tracker.html과 동일한 히트스프레이 HTML 생성
            return `
                <div class="hit-spray-content">
                    <div class="hit-spray-layout">
                        <div class="field-container">
                            <h4>히트스프레이</h4>
                            <div class="baseball-field" id="baseball-field-${playerData.이름}">
                                <div class="field-info">
                                    <small>PitchTrack 폴더의 JSON 파일에서 타구 위치를 점으로 표시합니다.</small>
                                </div>
                            </div>
                        </div>
                        <div class="hit-type-controls">
                            <h4>타구별 보기</h4>
                            <div class="hit-type-buttons" id="hit-type-buttons-${playerData.이름}">
                                <div class="loading">타구 데이터를 불러오는 중...</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 투구 구역에 점 출력
        function renderPitchZone(playerName) {
            const pitchZoneContainer = document.getElementById(`strike-zone-${playerName}`);
            if (!pitchZoneContainer) return;
            
            try {
                // PitchTrack 폴더에서 해당 선수의 JSON 파일 로드 시도
                const fileName = `${playerName}_Pitch.json`;
                const filePath = `./PitchTrack/${fileName}`;
                
                fetch(filePath)
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('파일을 찾을 수 없습니다');
                        }
                    })
                    .then(data => {
                        // 기존 투구 점들 제거
                        const existingPitches = pitchZoneContainer.querySelectorAll('.pitch-dot');
                        existingPitches.forEach(dot => dot.remove());
                        
                        // 투구 데이터가 있으면 점으로 표시
                        if (data.pitches && data.pitches.length > 0) {
                            data.pitches.forEach(pitch => {
                                const pitchDot = document.createElement('div');
                                pitchDot.className = 'pitch-dot';
                                pitchDot.style.left = `${pitch.x}px`;
                                pitchDot.style.top = `${pitch.y}px`;
                                pitchDot.title = `${pitch.type} - (${pitch.x}, ${pitch.y})`;
                                
                                // 구종별 색상 설정
                                pitchDot.style.backgroundColor = getPitchColor(pitch.type);
                                
                                pitchZoneContainer.appendChild(pitchDot);
                            });
                        }
                        
                        // 구종별 버튼 생성
                        generatePitchTypeButtons(playerName, data);
                    })
                    .catch(error => {
                        console.log(`${playerName}의 투구 데이터를 찾을 수 없습니다:`, error);
                        // 투구 구역에 안내 메시지 표시
                        const infoDiv = pitchZoneContainer.querySelector('.pitch-zone-info');
                        if (infoDiv) {
                            infoDiv.innerHTML = '<small>투구 데이터를 찾을 수 없습니다. PitchTrack 폴더에 JSON 파일이 있는지 확인해주세요.</small>';
                        }
                        
                        // 구종별 버튼도 안내 메시지로 변경
                        const buttonsContainer = document.getElementById(`pitch-type-buttons-${playerName}`);
                        if (buttonsContainer) {
                            buttonsContainer.innerHTML = '<div class="no-data">투구 데이터를 찾을 수 없습니다.</div>';
                        }
                    });
                    
            } catch (error) {
                console.error('투구 구역 렌더링 실패:', error);
            }
        }

        // 구종별 버튼 생성
        function generatePitchTypeButtons(playerName, data) {
            const buttonsContainer = document.getElementById(`pitch-type-buttons-${playerName}`);
            if (!buttonsContainer) return;
            
            if (!data.pitches || data.pitches.length === 0) {
                buttonsContainer.innerHTML = '<div class="no-data">투구 기록이 없습니다.</div>';
                return;
            }
            
            // 구종별 투구 수 계산
            const pitchCounts = {};
            data.pitches.forEach(pitch => {
                const type = pitch.type;
                pitchCounts[type] = (pitchCounts[type] || 0) + 1;
            });
            
            const totalPitches = data.pitches.length;
            
            // 전체보기 버튼을 맨 위에 추가 (2열 그리드에서 첫 번째 행 차지)
            let buttonsHTML = `
                <button class="pitch-type-button active" data-type="all" onclick="filterPitchesByType('${playerName}', 'all')" style="grid-column: 1 / -1;">
                    <span class="pitch-type-name">전체보기</span>
                    <span class="pitch-count">${totalPitches}개</span>
                </button>
            `;
            
            // 각 구종별 버튼 생성
            Object.entries(pitchCounts).forEach(([type, count]) => {
                const percentage = Math.round((count / totalPitches) * 100);
                
                buttonsHTML += `
                    <button class="pitch-type-button" data-type="${type}" onclick="filterPitchesByType('${playerName}', '${type}')">
                        <span class="pitch-type-name">${type}</span>
                        <span class="pitch-count">${percentage}%</span>
                    </button>
                `;
            });
            
            buttonsContainer.innerHTML = buttonsHTML;
        }

        // 구종별로 투구 점 필터링
        function filterPitchesByType(playerName, pitchType) {
            const pitchZoneContainer = document.getElementById(`strike-zone-${playerName}`);
            const buttonsContainer = document.getElementById(`pitch-type-buttons-${playerName}`);
            
            if (!pitchZoneContainer || !buttonsContainer) return;
            
            // 모든 버튼에서 active 클래스 제거
            buttonsContainer.querySelectorAll('.pitch-type-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 클릭된 버튼에 active 클래스 추가
            const clickedButton = buttonsContainer.querySelector(`[data-type="${pitchType}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // 모든 투구 점 숨기기
            const allPitchDots = pitchZoneContainer.querySelectorAll('.pitch-dot');
            allPitchDots.forEach(dot => {
                dot.style.display = 'none';
            });
            
            // 선택된 구종의 투구 점만 표시
            if (pitchType === 'all') {
                allPitchDots.forEach(dot => {
                    dot.style.display = 'block';
                });
            } else {
                allPitchDots.forEach(dot => {
                    const dotType = dot.title.split(' - ')[0];
                    if (dotType === pitchType) {
                        dot.style.display = 'block';
                    }
                });
            }
        }

        // 구종별 색상 반환 함수
        function getPitchColor(pitchType) {
            const colorMap = {
                '직구': '#ff4757',           // 빨강
                '라이징': '#8B4513',         // 갈색
                '커터': '#800020',           // 버건디
                '슬라이더': '#2ed573',       // 초록
                '싱커': '#ffa502',           // 주황
                '스플리터': '#00CED1',       // 청록
                '스크류볼': '#8A2BE2',       // 보라
                '라이징커터': '#8B4513',     // 갈색
                '라이징슬라이더': '#006400', // 짙은녹색
                '라이징싱커': '#FF69B4',     // 분홍색
                // 영어 이름도 지원
                'Fastball': '#ff4757',
                'Rising': '#8B4513',
                'Cutter': '#800020',
                'Slider': '#2ed573',
                'Sinker': '#ffa502',
                'Splitter': '#00CED1',
                'Screwball': '#8A2BE2',
                'Rising Cutter': '#8B4513',
                'Rising Slider': '#006400',
                'Rising Sinker': '#FF69B4'
            };
            
            // 구종 이름에서 색상 찾기
            for (const [key, color] of Object.entries(colorMap)) {
                if (pitchType.includes(key)) {
                    return color;
                }
            }
            
            // 기본 색상 (회색)
            return '#747d8c';
        }

        // 타구별 색상 반환 함수
        function getHitColor(hitType) {
            const colorMap = {
                'single': '#48bb78',      // 1루타: 초록색
                'double': '#4299e1',      // 2루타: 파란색
                'triple': '#9f7aea',      // 3루타: 보라색
                'homerun': '#f56565',     // 홈런: 빨간색
                // 한국어 타구 타입도 지원
                '1루타': '#48bb78',       // 1루타: 초록색
                '2루타': '#4299e1',       // 2루타: 파란색
                '3루타': '#9f7aea',       // 3루타: 보라색
                '홈런': '#f56565'         // 홈런: 빨간색
            };
            
            return colorMap[hitType] || '#999'; // 기본 색상 (회색)
        }

        // 히트스프레이 데이터를 로드하고 타구별 버튼을 생성하는 함수
        async function loadHitSprayData(playerName) {
            const fieldContainer = document.getElementById(`baseball-field-${playerName}`);
            if (!fieldContainer) return;

            // 이미지 로드 상태 확인
            checkImageLoad(fieldContainer);

            try {
                // HitSpray 폴더에서 해당 선수의 JSON 파일 로드 시도
                const fileName = `${playerName}_HitSpray.json`;
                const filePath = `./HitSpray/${fileName}`;
                
                console.log(`파일 경로 시도: ${filePath}`);
                
                const response = await fetch(filePath);
                if (!response.ok) {
                    // 다른 경로도 시도
                    const altPath = `../HitSpray/${fileName}`;
                    console.log(`대체 경로 시도: ${altPath}`);
                    const altResponse = await fetch(altPath);
                    if (!altResponse.ok) {
                        throw new Error('파일을 찾을 수 없습니다');
                    }
                    // 대체 경로로 데이터 로드
                    const data = await altResponse.json();
                    console.log(`${playerName}의 히트스프레이 데이터 (대체 경로):`, data);
                    
                    // 기존 타구 점들 제거
                    const existingHits = fieldContainer.querySelectorAll('.hit-marker');
                    existingHits.forEach(marker => marker.remove());
                    
                    // 타구 데이터가 있으면 점으로 표시
                    if (data.hits && data.hits.length > 0) {
                        data.hits.forEach(hit => {
                            const hitMarker = document.createElement('div');
                            hitMarker.className = `hit-marker ${hit.type}`;
                            hitMarker.style.left = `${hit.x}px`;
                            hitMarker.style.top = `${hit.y}px`;
                            hitMarker.title = `${hit.type} - (${hit.x}, ${hit.y})`;
                            
                            // 인라인 스타일로 색상 직접 적용
                            const hitColor = getHitColor(hit.type);
                            hitMarker.style.backgroundColor = hitColor;
                            
                            // 디버깅을 위한 콘솔 로그
                            console.log(`타구 점 생성:`, {
                                type: hit.type,
                                className: hitMarker.className,
                                x: hit.x,
                                y: hit.y,
                                color: hitColor
                            });
                            
                            fieldContainer.appendChild(hitMarker);
                        });
                    }
                    
                    // 타구별 버튼 생성
                    generateHitTypeButtons(playerName, data);
                    return;
                }

                const data = await response.json();
                console.log(`${playerName}의 히트스프레이 데이터:`, data);
                
                // 기존 타구 점들 제거
                const existingHits = fieldContainer.querySelectorAll('.hit-marker');
                existingHits.forEach(marker => marker.remove());
                
                // 타구 데이터가 있으면 점으로 표시
                if (data.hits && data.hits.length > 0) {
                    data.hits.forEach(hit => {
                        const hitMarker = document.createElement('div');
                        hitMarker.className = `hit-marker ${hit.type}`;
                        hitMarker.style.left = `${hit.x}px`;
                        hitMarker.style.top = `${hit.y}px`;
                        hitMarker.title = `${hit.type} - (${hit.x}, ${hit.y})`;
                        
                        // 디버깅을 위한 콘솔 로그
                        console.log(`타구 점 생성:`, {
                            type: hit.type,
                            className: hitMarker.className,
                            x: hit.x,
                            y: hit.y
                        });
                        
                        fieldContainer.appendChild(hitMarker);
                    });
                }
                
                // 타구별 버튼 생성
                generateHitTypeButtons(playerName, data);

            } catch (error) {
                console.log(`${playerName}의 히트스프레이 데이터를 찾을 수 없습니다:`, error);
                // 히트스프레이 구역에 안내 메시지 표시
                const infoDiv = fieldContainer.querySelector('.field-info');
                if (infoDiv) {
                    infoDiv.innerHTML = '<small>히트스프레이 데이터를 찾을 수 없습니다. HitSpray 폴더에 JSON 파일이 있는지 확인해주세요.<br>파일명: ' + playerName + '_HitSpray.json</small>';
                }
                
                // 타구별 버튼도 안내 메시지로 변경
                const buttonsContainer = document.getElementById(`hit-type-buttons-${playerName}`);
                if (buttonsContainer) {
                    buttonsContainer.innerHTML = '<div class="no-data">히트스프레이 데이터를 찾을 수 없습니다.</div>';
                }
            }
        }

        // 이미지 로드 상태 확인
        function checkImageLoad(field) {
            const img = new Image();
            
            img.onload = () => {
                console.log('SprayBG.png 이미지가 성공적으로 로드되었습니다.');
                field.style.backgroundImage = 'url("SprayBG.png")';
            };
            
            img.onerror = () => {
                console.log('SprayBG.png 이미지를 로드할 수 없습니다. 기본 야구장 배경을 사용합니다.');
                field.style.backgroundImage = 'none';
            };
            
            img.src = 'SprayBG.png';
        }

        // 타구별 버튼 생성
        function generateHitTypeButtons(playerName, data) {
            const buttonsContainer = document.getElementById(`hit-type-buttons-${playerName}`);
            if (!buttonsContainer) return;
            
            if (!data || !data.hits || data.hits.length === 0) {
                buttonsContainer.innerHTML = '<div class="no-data">타구 기록이 없습니다.</div>';
                return;
            }
            
            // 타구별 히트 수 계산
            const hitCounts = {};
            data.hits.forEach(hit => {
                const type = hit.type;
                hitCounts[type] = (hitCounts[type] || 0) + 1;
            });
            
            const totalHits = data.hits.length;
            
            // 전체보기 버튼을 맨 위에 추가 (2열 그리드에서 첫 번째 행 차지)
            let buttonsHTML = `
                <button class="hit-type-button active" data-type="all" onclick="filterHitsByType('${playerName}', 'all')" style="grid-column: 1 / -1;">
                    <span class="hit-type-name">전체보기</span>
                    <span class="hit-count">${totalHits}개</span>
                </button>
            `;
            
            // 각 타구별 버튼 생성
            Object.entries(hitCounts).forEach(([type, count]) => {
                const percentage = Math.round((count / totalHits) * 100);
                
                buttonsHTML += `
                    <button class="hit-type-button" data-type="${type}" onclick="filterHitsByType('${playerName}', '${type}')">
                        <span class="hit-type-name">${type}</span>
                        <span class="hit-count">${percentage}%</span>
                    </button>
                `;
            });
            
            buttonsContainer.innerHTML = buttonsHTML;
        }

        // 타구별로 히트 점 필터링
        function filterHitsByType(playerName, hitType) {
            const fieldContainer = document.getElementById(`baseball-field-${playerName}`);
            const buttonsContainer = document.getElementById(`hit-type-buttons-${playerName}`);
            
            if (!fieldContainer || !buttonsContainer) return;
            
            // 모든 버튼에서 active 클래스 제거
            buttonsContainer.querySelectorAll('.hit-type-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 클릭된 버튼에 active 클래스 추가
            const clickedButton = buttonsContainer.querySelector(`[data-type="${hitType}"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // 모든 히트 점 숨기기
            const allHitMarkers = fieldContainer.querySelectorAll('.hit-marker');
            allHitMarkers.forEach(marker => {
                marker.style.display = 'none';
            });
            
            // 선택된 타구의 히트 점만 표시
            if (hitType === 'all') {
                allHitMarkers.forEach(marker => {
                    marker.style.display = 'block';
                });
            } else {
                allHitMarkers.forEach(marker => {
                    const markerType = marker.title.split(' - ')[0];
                    if (markerType === hitType) {
                        marker.style.display = 'block';
                    }
                });
            }
        }

        // 언어 변경 기능
        document.addEventListener('DOMContentLoaded', function() {
            // 기존 함수 호출
            loadPlayerData();
            
            // 언어 변경 버튼 이벤트 리스너
            const languageBtns = document.querySelectorAll('.language-btn');
            
            languageBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const selectedLang = this.getAttribute('data-lang');
                    
                    // 활성 버튼 상태 변경
                    languageBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 언어 변경 처리
                    changeLanguage(selectedLang);
                });
            });
            
            // 저장된 언어 설정 복원
            const savedLang = localStorage.getItem('selectedLanguage') || 'ko';
            const languageBtn = document.querySelector(`[data-lang="${savedLang}"]`);
            if (languageBtn) {
                languageBtn.click();
            }
        });

        // 언어 변경 함수
        function changeLanguage(lang) {
            const translations = {
                ko: {
                    title: '선수정보 - WBD 기록실',
                    logoText: 'WBD 기록실',
                    recordRoom: '기록실',
                    seasonInfo: '시즌정보',
                    teamInfo: '팀정보',
                    playerInfo: '선수정보',
                    schedule: '경기일정',
                    pageTitle: '선수정보',
                    searchPlaceholder: '선수명을 입력하세요...',
                    statsTitle: '전체 선수 목록',
                    playerCount: '총 0명',
                    loading: '선수 데이터를 불러오는 중...',
                    noData: '타구 기록이 없습니다.',
                    allView: '전체보기'
                },
                ja: {
                    title: '選手情報 - WBD 記録室',
                    logoText: 'WBD 記録室',
                    recordRoom: '記録室',
                    seasonInfo: 'シーズン情報',
                    teamInfo: 'チーム情報',
                    playerInfo: '選手情報',
                    schedule: '試合日程',
                    pageTitle: '選手情報',
                    searchPlaceholder: '選手名を入力してください...',
                    statsTitle: '全選手一覧',
                    playerCount: '総0名',
                    loading: '選手データを読み込み中...',
                    noData: '打球記録がありません。',
                    allView: '全体表示'
                }
            };

            // 제목 변경
            document.title = translations[lang].title;
            document.querySelector('.logo-text').textContent = translations[lang].logoText;

            // 네비게이션 메뉴 변경
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, index) => {
                if (index === 0) item.textContent = translations[lang].recordRoom;
                else if (index === 1) item.textContent = translations[lang].seasonInfo;
                else if (index === 2) item.textContent = translations[lang].teamInfo;
                else if (index === 3) item.textContent = translations[lang].playerInfo;
                else if (index === 4) item.textContent = translations[lang].schedule;
            });

            // 페이지 제목 변경
            document.querySelector('.page-title').textContent = translations[lang].pageTitle;

            // 검색 입력창 플레이스홀더 변경
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.placeholder = translations[lang].searchPlaceholder;
            }

            // 통계 제목 변경
            const statsTitle = document.querySelector('.stats-title');
            if (statsTitle) {
                statsTitle.textContent = translations[lang].statsTitle;
            }

            // 로딩 메시지 변경
            const loadingElement = document.querySelector('.loading');
            if (loadingElement) {
                loadingElement.textContent = translations[lang].loading;
            }

            // 로컬 스토리지에 언어 설정 저장
            localStorage.setItem('selectedLanguage', lang);
        }
    </script>
</body>
</html>