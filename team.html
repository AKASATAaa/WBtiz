<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>팀정보 - WBD 기록실</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
            background-color: #f8f9fa;
        }
        
        .header {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
            padding: 0;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #ff4757, #ff3742);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .search-icon, .user-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .search-icon svg, .user-icon svg {
            width: 20px;
            height: 20px;
            fill: #666;
        }
        
        .user-icon {
            background-color: #ff4757;
            border-radius: 50%;
        }
        
        .user-icon svg {
            fill: white;
        }
        
        .nav-container {
            background-color: white;
            border-bottom: 1px solid #e9ecef;
        }
        
        .nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            padding: 0 20px;
        }
        
        .nav-item {
            padding: 16px 20px;
            color: #666;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
        }
        
        .nav-item:hover {
            color: #333;
            border-bottom-color: #ff4757;
        }
        
        .nav-item.active {
            color: #333;
            border-bottom-color: #ff4757;
        }

        .main-content {
            background-color: #f8f9fa;
            min-height: 100vh;
            padding: 20px 0;
        }

        .content-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
            font-size: 14px;
            color: #333;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #ff4757;
        }

        .teams-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .team-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--team-color), var(--team-color-secondary));
        }

        .team-card.expanded {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom: none;
        }

        .team-header {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .team-logo {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: contain;
            background-color: #f8f9fa;
            padding: 8px;
        }

        .team-info {
            flex: 1;
        }

        .team-name {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .team-years {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .team-arrow {
            color: #999;
            font-size: 18px;
            margin-left: 20px;
            transition: transform 0.3s ease;
        }

        .team-card.expanded .team-arrow {
            transform: rotate(90deg);
        }

        /* 팀 상세 정보 스타일 */
        .team-details {
            padding: 20px;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-top: 0;
            display: none;
            flex-direction: column;
            gap: 20px;
            border-top: 1px solid #e9ecef;
        }

        .team-details.show {
            display: flex;
        }

        /* 정보 섹션들을 한 줄로 나열하는 그리드 */
        .info-sections {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .info-sections > .info-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid #e9ecef;
            min-width: 0;
        }

        .info-sections > .info-section:nth-child(1) {
            grid-column: 1;
        }

        .info-sections > .info-section:nth-child(2) {
            grid-column: 2;
        }

        .info-sections > .info-section:nth-child(3) {
            grid-column: 3;
        }

        .info-section h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        /* 팀 성적 섹션 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-item {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--team-color, #4a90e2);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        /* 최근 경기 섹션 */
        .recent-games {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .game-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }

        .game-result.win {
            border-left: 3px solid #28a745;
        }

        .game-result.loss {
            border-left: 3px solid #dc3545;
        }

        .game-result .opponent {
            font-weight: 600;
            color: #333;
        }

        .game-result .result {
            font-weight: 700;
            color: #333;
        }

        .game-result .score {
            color: #666;
        }

        /* 다음 경기 섹션 */
        .next-games {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .next-game {
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }

        .next-game .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .next-game .opponent {
            font-weight: 600;
            color: #333;
        }

        .next-game .venue {
            font-size: 10px;
            color: #666;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .next-game .game-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #666;
        }

        .no-upcoming {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 8px;
        }

        .no-recent {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 8px;
        }

        /* 상대 전적 섹션 */
        .head-to-head {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .h2h-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            font-size: 12px;
        }

        .h2h-item .opponent {
            font-weight: 600;
            color: #333;
        }

        .h2h-item .record {
            color: #666;
        }

        .h2h-item .win-rate {
            font-weight: 600;
            color: var(--team-color, #4a90e2);
        }

        /* 타자 기록 영역 - 전체 너비 사용 */
        .info-section:last-child {
            grid-column: 1 / -1;
            width: 100%;
            min-height: auto;
        }

        /* 모바일 반응형 */
        @media (max-width: 768px) {
            .batting-stats-table {
                font-size: 12px;
            }
            
            .batting-stats-table th,
            .batting-stats-table td {
                padding: 8px 2px;
            }
            
            .batting-stats-table .player-name {
                padding-left: 8px;
            }
            
            .pitching-stats-table {
                font-size: 12px;
            }
            
            .pitching-stats-table th,
            .pitching-stats-table td {
                padding: 8px 2px;
            }
            
            .pitching-stats-table .player-name {
                padding-left: 8px;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .filter-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .info-sections {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .batting-stats-container .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .batting-stats-table {
                font-size: 11px;
            }
            
            .batting-stats-table th,
            .batting-stats-table td {
                padding: 6px 1px;
            }
            
            .batting-stats-table .player-name {
                padding-left: 6px;
            }
            
            .pitching-stats-table {
                font-size: 11px;
            }
            
            .pitching-stats-table td {
                padding: 6px 1px;
            }
            
            .pitching-stats-table .player-name {
                padding-left: 6px;
            }
            
            .info-sections {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .batting-stats-container .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-item {
                font-size: 12px;
                padding: 6px 8px;
            }
        }

        .loading, .no-data, .error {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }

        .error {
            color: #dc3545;
        }

        /* 타자 기록 테이블 스타일 */
        .batting-stats-container {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .batting-stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            table-layout: fixed;
        }

        .batting-stats-table th {
            background: #f8f9fa;
            color: #333;
            padding: 12px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid #e9ecef;
            white-space: nowrap;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .batting-stats-table th:hover {
            background: #e9ecef;
        }

        .batting-stats-table th.sortable {
            position: relative;
        }

        .batting-stats-table th.sortable::after {
            content: '↕';
            position: absolute;
            right: 8px;
            color: #999;
        }

        .batting-stats-table th.sort-asc::after {
            content: '↑';
            color: #333;
        }

        .batting-stats-table th.sort-desc::after {
            content: '↓';
            color: #333;
        }

        .batting-stats-table td {
            padding: 10px 4px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            white-space: nowrap;
        }

        .batting-stats-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .batting-stats-table .player-name {
            text-align: left;
            font-weight: 600;
            color: #333;
            padding-left: 12px;
        }

        /* 컬럼 너비 조정 */
        .batting-stats-table th:nth-child(1), /* 선수명 */
        .batting-stats-table td:nth-child(1) {
            width: 20%;
        }

        .batting-stats-table th:not(:first-child), /* 통계 컬럼들 */
        .batting-stats-table td:not(:first-child) {
            width: 10%;
        }

        /* 투수 기록 테이블 스타일 */
        .pitching-stats-container {
            width: 100%;
            padding: 0;
            margin: 0;
        }

        .pitching-stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            table-layout: fixed;
        }

        .pitching-stats-table th {
            background: #f8f9fa;
            color: #333;
            padding: 12px 4px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            border: 1px solid #e9ecef;
            white-space: nowrap;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .pitching-stats-table th:hover {
            background: #e9ecef;
        }

        .pitching-stats-table th.sortable {
            position: relative;
        }

        .pitching-stats-table th.sortable::after {
            content: '↕';
            position: absolute;
            right: 8px;
            color: #999;
        }

        .pitching-stats-table th.sort-asc::after {
            content: '↑';
            color: #333;
        }

        .pitching-stats-table th.sort-desc::after {
            content: '↓';
            color: #333;
        }

        .pitching-stats-table td {
            padding: 10px 4px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            white-space: nowrap;
        }

        .pitching-stats-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .pitching-stats-table .player-name {
            text-align: left;
            font-weight: 600;
            color: #333;
            padding-left: 12px;
        }

        /* 컬럼 너비 조정 */
        .pitching-stats-table th:nth-child(1), /* 선수명 */
        .pitching-stats-table td:nth-child(1) {
            width: 20%;
        }

        .pitching-stats-table th:not(:first-child), /* 통계 컬럼들 */
        .pitching-stats-table td:not(:first-child) {
            width: 13.3%;
        }

        @media (max-width: 768px) {
            .batting-stats-table {
                font-size: 12px;
            }
            
            .batting-stats-table th,
            .batting-stats-table td {
                padding: 8px 2px;
            }
            
            .batting-stats-table .player-name {
                padding-left: 8px;
            }
            
            .pitching-stats-table {
                font-size: 12px;
            }
            
            .pitching-stats-table th,
            .pitching-stats-table td {
                padding: 8px 2px;
            }
            
            .pitching-stats-table .player-name {
                padding-left: 8px;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .filter-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .info-sections {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .batting-stats-container .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .batting-stats-table {
                font-size: 11px;
            }
            
            .batting-stats-table th,
            .batting-stats-table td {
                padding: 6px 1px;
            }
            
            .batting-stats-table .player-name {
                padding-left: 6px;
            }
            
            .pitching-stats-table {
                font-size: 11px;
            }
            
            .pitching-stats-table td {
                padding: 6px 1px;
            }
            
            .pitching-stats-table .player-name {
                padding-left: 6px;
            }
            
            .info-sections {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .batting-stats-container .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-item {
                font-size: 12px;
                padding: 6px 8px;
            }
        }

        /* 팀별 색상 */
        .team-moonshot {
            --team-color: #e74c3c;
            --team-color-secondary: #c0392b;
        }

        .team-ishikawa {
            --team-color: #2c3e50;
            --team-color-secondary: #34495e;
        }

        .team-nyanko {
            --team-color: #27ae60;
            --team-color-secondary: #229954;
        }

        .team-leroleros {
            --team-color: #8e44ad;
            --team-color-secondary: #7d3c98;
        }

        .team-florian {
            --team-color: #e67e22;
            --team-color-secondary: #d35400;
        }

        .team-bubble {
            --team-color: #3498db;
            --team-color-secondary: #2980b9;
        }

        .game-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px;
            margin-bottom: 4px;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .result-box {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .game-details {
            flex: 1;
            text-align: right;
        }
        
        .vs-opponent {
            font-weight: bold;
            color: #333;
            margin-bottom: 2px;
            font-size: 11px;
        }
        
        .score {
            font-size: 11px;
            color: #666;
        }
        
        .head-to-head h4 {
            font-size: 16px;
            margin-bottom: 8px;
        }
        
        .head-to-head .opponent-record {
            font-size: 15px;
            margin-bottom: 6px;
        }

        .next-game h4 {
            font-size: 16px;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .next-game-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            background: #f9f9f9;
            text-align: center;
        }
        
        .next-game-header {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .next-game-venue {
            font-size: 14px;
            color: #666;
            margin-bottom: 12px;
            padding: 4px 12px;
            background: #e9ecef;
            border-radius: 4px;
            display: inline-block;
        }
        
        .next-game-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        
        .next-game-date {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .next-game-time {
            font-size: 16px;
            font-weight: bold;
            color: #666;
        }
        
        .no-next-game {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">W</div>
                <span class="logo-text">WBD 기록실</span>
            </a>
            
            <div class="header-actions">
                <div class="search-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </div>
                
                <div class="user-icon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
            </div>
        </div>
    </header>
    
    <nav class="nav-container">
        <div class="nav">
            <a href="record_bat_basic.html" class="nav-item">기록실</a>
            <a href="season.html" class="nav-item">시즌정보</a>
            <a href="team.html" class="nav-item active">팀정보</a>
            <a href="player.html" class="nav-item">선수정보</a>
            <a href="schedule.html" class="nav-item">경기일정</a>


        </div>
    </nav>

    <main class="main-content">
        <div class="content-container">
            <div class="page-header">
                <h1 class="page-title">팀정보</h1>
                <div class="filter-controls">
                    <select class="filter-select" id="team-filter">
                        <option value="all">팀</option>
                        <option value="moonshot">MoonShot Spirits</option>
                        <option value="ishikawa">Ishikawa Fighting Folks</option>
                        <option value="nyanko">Nyanko Avengers</option>
                        <option value="leroleros">Leroleros</option>
                        <option value="florian">Florian T-Shrits</option>
                        <option value="bubble">Bubble Stars</option>
                    </select>
                    <select class="filter-select" id="overall-filter">
                        <option value="all">팀종합</option>
                        <option value="name">이름순</option>
                    </select>
                </div>
            </div>

            <div class="teams-grid" id="teams-container">
                <!-- 팀 카드들이 여기에 동적으로 생성됩니다 -->
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // 팀 데이터
        let teamsData = [];
        let playerStatsData = {};
        let leagueTeamData = {};
        let scheduleData = [];

        // League_Team 파일에서 팀 정보를 로드하는 함수
        async function loadLeagueTeamData() {
            try {
                const response = await fetch('./Data/League_Team.xlsx');
                if (!response.ok) {
                    throw new Error('League_Team 파일을 불러올 수 없습니다');
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                console.log('League_Team 파일의 모든 시트:', workbook.SheetNames);
                
                // "2025 썸머시즌" 시트 찾기 (시즌 이름과 동일)
                const seasonSheet = workbook.SheetNames.find(sheetName => 
                    sheetName === '2025 썸머시즌'
                );
                
                if (!seasonSheet) {
                    console.error('2025 썸머시즌 시트를 찾을 수 없습니다');
                    return;
                }
                
                console.log('시즌 시트:', seasonSheet);
                
                // 시즌 시트에서 팀 정보와 팀원 읽기
                const worksheet = workbook.Sheets[seasonSheet];
                const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                console.log('시즌 시트 데이터 구조:', sheetData.slice(0, 5));
                
                if (sheetData.length > 0) {
                    const teams = [];
                    
                    // 1행에서 팀명들을 찾기 (B1부터)
                    const teamRow = sheetData[0]; // 1행 (인덱스 0)
                    const abbreviationRow = sheetData[1]; // 2행 (인덱스 1)
                    
                    if (teamRow && abbreviationRow) {
                        console.log('팀명 행:', teamRow);
                        console.log('줄임말 행:', abbreviationRow);
                        
                        // B열부터 팀명과 줄임말을 찾기
                        for (let colIndex = 1; colIndex < teamRow.length; colIndex++) {
                            const teamName = teamRow[colIndex];
                            const abbreviation = abbreviationRow[colIndex];
                            
                            if (teamName && typeof teamName === 'string' && teamName.trim()) {
                                console.log(`팀 발견: "${teamName}" (줄임말: "${abbreviation}")`);
                                
                                const teamMembers = [];
                                
                                // 3행부터 선수명들을 찾기 (팀원들)
                                for (let rowIndex = 2; rowIndex < sheetData.length; rowIndex++) {
                                    const playerName = sheetData[rowIndex][colIndex];
                                    
                                    if (playerName && typeof playerName === 'string' && playerName.trim()) {
                                        // 팀원(주장)인지 확인
                                        const isCaptain = sheetData[rowIndex][0] && 
                                                        sheetData[rowIndex][0].toString().includes('주장');
                                        
                                        let teamType = '팀원';
                                        if (isCaptain) {
                                            teamType = '팀원(주장)';
                                        }
                                        
                                        teamMembers.push({
                                            name: playerName.trim(),
                                            team: teamType,
                                            teamName: teamName.trim(),
                                            abbreviation: abbreviation ? abbreviation.toString().trim() : ''
                                        });
                                        
                                        console.log(`  선수: "${playerName}" (${teamType})`);
                                    }
                                }
                                
                                teams.push({
                                    name: teamName.trim(),
                                    abbreviation: abbreviation ? abbreviation.toString().trim() : '',
                                    league: '2025 썸머시즌',
                                    members: teamMembers
                                });
                            }
                        }
                    }
                    
                    // 시즌 시트의 데이터를 "2025 썸머시즌" 키로 저장
                    leagueTeamData['2025 썸머시즌'] = teams;
                    console.log(`시즌 시트의 팀 정보:`, teams);
                }
                
                console.log('전체 리그 팀 데이터:', leagueTeamData);
                
            } catch (error) {
                console.error('League_Team 데이터 로딩 실패:', error);
            }
        }

        // Schedule.csv 파일에서 경기 일정 데이터를 로드하는 함수
        async function loadScheduleData() {
            try {
                const response = await fetch('./Data/schedule.csv');
                if (!response.ok) {
                    throw new Error('Schedule.csv 파일을 불러올 수 없습니다');
                }
                
                const csvText = await response.text();
                console.log('CSV 원본 텍스트 (처음 500자):', csvText.substring(0, 500));
                
                const lines = csvText.split('\n');
                console.log('CSV 라인 수:', lines.length);
                console.log('첫 번째 라인:', lines[0]);
                console.log('두 번째 라인:', lines[1]);
                
                const headers = lines[0].split(',').map(h => h.trim());
                console.log('Schedule.csv 헤더:', headers);
                
                const schedule = [];
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim()) {
                        const values = lines[i].split(',').map(v => v.trim());
                        const row = {};
                        headers.forEach((header, index) => {
                            row[header] = values[index] || '';
                        });
                        schedule.push(row);
                        
                        // 처음 몇 개 행만 로그로 출력
                        if (i <= 3) {
                            console.log(`행 ${i}:`, row);
                        }
                    }
                }
                
                scheduleData = schedule;
                console.log('Schedule.csv 데이터 로드 완료:', scheduleData.length, '개 경기');
                console.log('첫 번째 경기:', scheduleData[0]);
                console.log('모든 경기 데이터:', scheduleData);
                
            } catch (error) {
                console.error('Schedule.csv 데이터 로딩 실패:', error);
                console.log('CSV 파일이 없거나 읽을 수 없습니다. 샘플 데이터를 생성합니다.');
                
                // 샘플 데이터 생성
                scheduleData = generateSampleScheduleData();
                console.log('샘플 데이터 생성 완료:', scheduleData.length, '개 경기');
                console.log('샘플 데이터 예시:', scheduleData.slice(0, 3));
            }
        }

        // 샘플 경기 일정 데이터 생성 함수
        function generateSampleScheduleData() {
            const teams = ['MoonShot Spirits', 'Ishikawa Fighting Folks', 'Nyanko Avengers', 'Leroleros', 'Florian T-Shrits', 'Bubble Stars'];
            const sampleData = [];
            
            // 2025년 6월-8월 경기 일정 생성
            for (let month = 6; month <= 8; month++) {
                for (let day = 1; day <= 30; day += 3) { // 3일마다 경기
                    if (day <= 28 || (month === 6 && day <= 30) || (month === 7 && day <= 31)) {
                        const homeTeam = teams[Math.floor(Math.random() * teams.length)];
                        let awayTeam = teams[Math.floor(Math.random() * teams.length)];
                        while (awayTeam === homeTeam) {
                            awayTeam = teams[Math.floor(Math.random() * teams.length)];
                        }
                        
                        // 오늘 날짜 기준으로 과거/미래 경기 구분
                        const gameDate = new Date(2025, month - 1, day);
                        const today = new Date();
                        const isCompleted = gameDate < today; // 오늘 이전이면 완료된 경기
                        
                        let result = '';
                        let score = '';
                        
                        if (isCompleted) {
                            const homeScore = Math.floor(Math.random() * 10) + 1;
                            const awayScore = Math.floor(Math.random() * 10) + 1;
                            score = `${homeScore}-${awayScore}`;
                            result = homeScore > awayScore ? `홈승 ${score}` : `원정승 ${score}`;
                        } else {
                            result = '예정';
                            score = '';
                        }
                        
                        sampleData.push({
                            날짜: `2025.${month.toString().padStart(2, '0')}.${day.toString().padStart(2, '0')}`,
                            시간: '18:00',
                            홈팀: homeTeam,
                            원정팀: awayTeam,
                            결과: result,
                            장소: 'WBD 야구장'
                        });
                    }
                }
            }
            
            return sampleData;
        }

        // PlayerStatsLeague 파일에서 선수 통계 데이터를 로드하는 함수
        async function loadPlayerStatsData() {
            try {
                const response = await fetch('./Data/PlayerStatsLeague.xlsx');
                if (!response.ok) {
                    throw new Error('PlayerStatsLeague 파일을 불러올 수 없습니다');
                }
                
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                console.log('PlayerStatsLeague 파일의 모든 시트:', workbook.SheetNames);
                
                // 각 시트(리그)의 선수 통계를 파싱
                workbook.SheetNames.forEach(sheetName => {
                    if (sheetName !== '~$PlayerStatsLeague') { // 임시 파일 제외
                        const worksheet = workbook.Sheets[sheetName];
                        const sheetData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        console.log(`시트 "${sheetName}"의 데이터 구조:`, sheetData.slice(0, 5));
                        
                        if (sheetData.length > 0) {
                            const headers = sheetData[0];
                            const players = [];
                            
                            console.log(`시트 "${sheetName}"의 헤더:`, headers);
                            
                            for (let i = 1; i < sheetData.length; i++) {
                                const row = sheetData[i];
                                const playerData = {};
                                
                                headers.forEach((header, index) => {
                                    if (header && typeof header === 'string') {
                                        playerData[header] = row[index] || '';
                                    }
                                });
                                
                                // 이름 필드가 있으면 선수로 추가 (팀 필드는 선택사항)
                                if (playerData.이름 && playerData.이름.trim()) {
                                    players.push(playerData);
                                    console.log(`선수 추가: "${playerData.이름}"`, playerData);
                                }
                            }
                            
                            playerStatsData[sheetName] = players;
                            console.log(`시트 "${sheetName}"의 선수 데이터 (${players.length}명):`, players.slice(0, 3));
                        }
                    }
                });
                
                console.log('전체 선수 통계 데이터:', playerStatsData);
                
            } catch (error) {
                console.error('PlayerStatsLeague 데이터 로딩 실패:', error);
            }
        }

        // 팀 데이터를 생성하는 함수
        function generateTeamsData() {
            const teams = [];
            
            // 오늘 날짜 가져오기
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0]; // YYYY-MM-DD 형식
            
            // League_Team 데이터에서 팀 정보를 동적으로 생성
            Object.entries(leagueTeamData).forEach(([leagueName, leagueTeams]) => {
                leagueTeams.forEach(leagueTeam => {
                    // 팀 ID 생성 (팀명을 기반으로 고유 ID 생성)
                    const teamId = leagueTeam.name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
                    
                    // 팀별 색상 클래스 결정
                    let colorClass = 'team-default';
                    if (teamId.includes('moonshot')) colorClass = 'team-moonshot';
                    else if (teamId.includes('ishikawa')) colorClass = 'team-ishikawa';
                    else if (teamId.includes('nyanko')) colorClass = 'team-nyanko';
                    else if (teamId.includes('leroleros')) colorClass = 'team-leroleros';
                    else if (teamId.includes('florian')) colorClass = 'team-florian';
                    else if (teamId.includes('bubble')) colorClass = 'team-bubble';
                    
                    // 로고 이미지 경로 생성
                    const logoPath = `Image/Team/${leagueTeam.name}.png`;
                    
                    // Schedule.csv에서 해당 팀의 경기 정보 찾기
                    const teamSchedule = scheduleData.filter(game => {
                        // 필드명을 여러 가지로 시도 (한글/영문 필드명 모두 지원)
                        const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                        const awayTeam = game.원정팀 || game['원정팀'] || game.away_team || game.awayTeam || game['away_team'] || '';
                        const teamName = leagueTeam.name;
                        
                        console.log(`경기 데이터 확인:`, {
                            game: game,
                            homeTeam: homeTeam,
                            awayTeam: awayTeam,
                            teamName: teamName,
                            homeMatch: homeTeam === teamName,
                            awayMatch: awayTeam === teamName
                        });
                        
                        // 정확한 매칭과 부분 매칭 모두 시도
                        const isHomeMatch = homeTeam === teamName || 
                                          (homeTeam && homeTeam.includes(teamName)) || 
                                          (teamName && teamName.includes(homeTeam));
                        const isAwayMatch = awayTeam === teamName || 
                                          (awayTeam && awayTeam.includes(teamName)) || 
                                          (teamName && teamName.includes(awayTeam));
                        
                        const isMatch = isHomeMatch || isAwayMatch;
                        
                        if (isMatch) {
                            console.log(`✅ 팀 "${teamName}" 매칭 성공: 홈팀="${homeTeam}", 원정팀="${awayTeam}"`);
                        } else {
                            console.log(`❌ 팀 "${teamName}" 매칭 실패: 홈팀="${homeTeam}", 원정팀="${awayTeam}"`);
                        }
                        
                        return isMatch;
                    });
                    
                    console.log(`팀 "${leagueTeam.name}"의 경기 일정:`, teamSchedule);
                    console.log(`총 ${teamSchedule.length}경기 발견`);
                    
                    // 날짜별로 경기 정렬 (YYYY.MM.DD 형식을 Date 객체로 변환)
                    const sortedSchedule = teamSchedule.sort((a, b) => {
                        const dateA = new Date(a.날짜?.replace(/\./g, '-') || a.date?.replace(/\./g, '-') || '1900-01-01');
                        const dateB = new Date(b.날짜?.replace(/\./g, '-') || b.date?.replace(/\./g, '-') || '1900-01-01');
                        return dateA - dateB;
                    });
                    
                    console.log(`정렬된 경기 일정:`, sortedSchedule);
                    
                    // 최근 경기 (완료된 경기, 오늘 날짜 이전)
                    const completedGames = sortedSchedule.filter(game => {
                        // 스코어 필드명도 여러 가지로 시도
                        const homeScore = game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '';
                        const awayScore = game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '';
                        const gameDate = game.날짜 || game.date || '';
                        
                        // 스코어가 있으면 완료된 경기
                        const isCompleted = homeScore && awayScore && homeScore !== '' && awayScore !== '';
                        
                        if (!isCompleted) {
                            console.log(`경기 "${gameDate} ${game.홈팀 || game.home_team} vs ${game.원정팀 || game.away_team}" - 미완료 (스코어: ${homeScore}-${awayScore})`);
                            return false;
                        }
                        
                        const parsedDate = new Date(gameDate?.replace(/\./g, '-') || '1900-01-01');
                        const isPast = parsedDate < today;
                        console.log(`경기 "${gameDate} ${game.홈팀 || game.home_team} vs ${game.원정팀 || game.away_team}" - ${isPast ? '과거' : '미래'} (스코어: ${homeScore}-${awayScore})`);
                        return isPast;
                    }).slice(-3); // 최근 3경기
                    
                    console.log(`완료된 경기:`, completedGames);
                    
                    // 다음 경기 (예정된 경기, 오늘 날짜 이후, 가장 가까운 1개)
                    const upcomingGames = sortedSchedule.filter(game => {
                        const homeScore = game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '';
                        const awayScore = game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '';
                        const gameDate = game.날짜 || game.date || '';
                        
                        // 스코어가 없으면 예정된 경기
                        const isScheduled = !homeScore || !awayScore || homeScore === '' || awayScore === '';
                        
                        if (!isScheduled) {
                            console.log(`경기 "${gameDate} ${game.홈팀 || game.home_team} vs ${game.원정팀 || game.away_team}" - 이미 완료됨 (스코어: ${homeScore}-${awayScore})`);
                            return false;
                        }
                        
                        const parsedDate = new Date(gameDate?.replace(/\./g, '-') || '1900-01-01');
                        const isFuture = parsedDate >= today;
                        console.log(`경기 "${gameDate} ${game.홈팀 || game.home_team} vs ${game.원정팀 || game.away_team}" - ${isFuture ? '미래' : '과거'} (예정)`);
                        return isFuture;
                    }).slice(0, 1); // 다음 1경기만
                    
                    console.log(`예정된 경기:`, upcomingGames);
                    
                    // 상대 전적 계산 (완료된 경기만)
                    const headToHead = {};
                    const opponents = ['ishikawa', 'nyanko', 'leroleros', 'florian', 'bubble'];
                    
                    opponents.forEach(opponent => {
                        const games = sortedSchedule.filter(game => {
                            // 경기가 완료되었는지 확인 (스코어 존재 여부로 판단)
                            const homeScore = game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '';
                            const awayScore = game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '';
                            
                            const isCompleted = homeScore && awayScore && homeScore !== '' && awayScore !== '';
                            if (!isCompleted) {
                                return false;
                            }
                            
                            // 상대팀과의 경기인지 확인
                            const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                            const awayTeam = game.원정팀 || game['원정팀'] || game.away_team || game.awayTeam || game['away_team'] || '';
                            const isHome = homeTeam === leagueTeam.name;
                            const opponentTeam = isHome ? awayTeam : homeTeam;
                            
                            const isMatch = opponentTeam?.toLowerCase().includes(opponent) || 
                                          opponentTeam?.toLowerCase().includes(opponent.replace('-', ' '));
                            
                            if (isMatch) {
                                console.log(`상대 전적 매칭: ${leagueTeam.name} vs ${opponentTeam} (${opponent}) - 스코어: ${homeScore}-${awayScore}`);
                            }
                            
                            return isMatch;
                        });
                        
                        console.log(`상대팀 ${opponent}와의 경기:`, games);
                        
                        const wins = games.filter(game => {
                            const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                            const homeScore = parseInt(game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '0');
                            const awayScore = parseInt(game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '0');
                            
                            const isHome = homeTeam === leagueTeam.name;
                            if (isHome) {
                                return homeScore > awayScore; // 홈팀이 더 높은 스코어
                            } else {
                                return awayScore > homeScore; // 원정팀이 더 높은 스코어
                            }
                        }).length;
                        
                        const losses = games.filter(game => {
                            const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                            const homeScore = parseInt(game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '0');
                            const awayScore = parseInt(game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '0');
                            
                            const isHome = homeTeam === leagueTeam.name;
                            if (isHome) {
                                return homeScore < awayScore; // 홈팀이 더 낮은 스코어
                            } else {
                                return awayScore < homeScore; // 원정팀이 더 낮은 스코어
                            }
                        }).length;
                        
                        const totalGames = wins + losses;
                        const winRate = totalGames > 0 ? ((wins / totalGames) * 100).toFixed(1) + '%' : '0.0%';
                        
                        console.log(`상대팀 ${opponent} 전적: ${wins}승 ${losses}패 (${winRate})`);
                        
                        headToHead[opponent] = { wins, losses, winRate, totalGames };
                    });
                    
                    console.log(`팀 "${leagueTeam.name}"의 상대 전적:`, headToHead);
                    
                    const team = {
                        id: teamId,
                        name: leagueTeam.name,
                        abbreviation: leagueTeam.abbreviation,
                        logo: logoPath,
                        years: leagueName,
                        colorClass: colorClass,
                        league: leagueName,
                        details: {
                            wins: completedGames.filter(game => {
                                const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                                const homeScore = parseInt(game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '0');
                                const awayScore = parseInt(game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '0');
                                
                                const isHome = homeTeam === leagueTeam.name;
                                if (isHome) {
                                    return homeScore > awayScore; // 홈팀이 더 높은 스코어
                                } else {
                                    return awayScore > homeScore; // 원정팀이 더 높은 스코어
                                }
                            }).length,
                            losses: completedGames.filter(game => {
                                const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                                const homeScore = parseInt(game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '0');
                                const awayScore = parseInt(game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '0');
                                
                                const isHome = homeTeam === leagueTeam.name;
                                if (isHome) {
                                    return homeScore < awayScore; // 홈팀이 더 낮은 스코어
                                } else {
                                    return awayScore < homeScore; // 원정팀이 더 낮은 스코어
                                }
                            }).length,
                            winRate: '0.0%',
                            description: `${leagueTeam.name}는 야구에 대한 열정과 도전 정신을 바탕으로 한 팀입니다. 매 경기마다 최선을 다해 플레이하며, 팬들과 함께하는 즐거운 야구를 추구합니다.`,
                            recentGames: completedGames.map(game => {
                                const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                                const awayTeam = game.원정팀 || game['원정팀'] || game.away_team || game.awayTeam || game['away_team'] || '';
                                const homeScore = parseInt(game.홈스코어 || game['홈스코어'] || game.home_score || game.homeScore || game['home_score'] || '0');
                                const awayScore = parseInt(game.원정스코어 || game['원정스코어'] || game.away_score || game.awayScore || game['away_score'] || '0');
                                
                                const isHome = homeTeam === leagueTeam.name;
                                const opponent = isHome ? awayTeam : homeTeam;
                                
                                // 스코어로 승패 판단
                                let result = 'L';
                                if (isHome) {
                                    result = homeScore > awayScore ? 'W' : 'L';
                                } else {
                                    result = awayScore > homeScore ? 'W' : 'L';
                                }
                                
                                // 스코어 표시
                                const score = `${homeScore}-${awayScore}`;
                                const gameDate = game.날짜 || game.date || '';
                                
                                return { opponent, result, score, date: gameDate };
                            }),
                            nextGames: upcomingGames.map(game => {
                                const homeTeam = game.홈팀 || game['홈팀'] || game.home_team || game.homeTeam || game['home_team'] || '';
                                const awayTeam = game.원정팀 || game['원정팀'] || game.away_team || game.awayTeam || game['away_team'] || '';
                                const isHome = homeTeam === leagueTeam.name;
                                const opponent = isHome ? awayTeam : homeTeam;
                                const date = game.날짜 || game.date || '';
                                const time = game.시간 || game.time || '';
                                
                                return { opponent, date, time, isHome };
                            }),
                            headToHead: headToHead
                        }
                    };
                    
                    // 승률 계산
                    const totalGames = team.details.wins + team.details.losses;
                    if (totalGames > 0) {
                        team.details.winRate = ((team.details.wins / totalGames) * 100).toFixed(1) + '%';
                    }
                    
                    teams.push(team);
                });
            });
            
            return teams;
        }

        // 타자 기록을 로드하고 표시하는 함수
        async function loadBattingStats(teamId) {
            const team = teamsData.find(t => t.id === teamId);
            if (!team) {
                console.error('팀을 찾을 수 없습니다:', teamId);
                return;
            }
            
            console.log('=== 타자 기록 로딩 시작 ===');
            console.log('팀:', team.name, '리그:', team.league);
            console.log('사용 가능한 playerStatsData 키들:', Object.keys(playerStatsData));
            
            const statsContainer = document.getElementById(`batting-stats-${teamId}`);
            if (!statsContainer) {
                console.error('통계 컨테이너를 찾을 수 없습니다');
                return;
            }
            
            try {
                // League_Team에서 해당 팀의 팀원 목록 찾기
                let teamMembers = [];
                
                if (leagueTeamData[team.league]) {
                    const foundTeam = leagueTeamData[team.league].find(t => 
                        t.name === team.name || 
                        t.abbreviation === team.abbreviation ||
                        t.name.includes(team.name) || 
                        team.name.includes(t.name)
                    );
                    
                    if (foundTeam) {
                        if (foundTeam.members && foundTeam.members.length > 0) {
                            teamMembers = foundTeam.members.map(member => member.name);
                        } else {
                            teamMembers = [team.name]; // 임시로 팀명 사용
                        }
                    } else {
                        teamMembers = [team.name]; // 임시로 팀명 사용
                    }
                } else {
                    teamMembers = [team.name]; // 임시로 팀명 사용
                }
                
                console.log('팀원 목록:', teamMembers);
                
                if (teamMembers.length === 0) {
                    statsContainer.innerHTML = '<div class="no-data">팀원 정보를 찾을 수 없습니다.</div>';
                    return;
                }
                
                // PlayerStatsLeague에서 "(리그이름) 타자" 시트 찾기
                const battingSheetName = `${team.league} 타자`;
                console.log('찾는 시트:', battingSheetName);
                console.log('사용 가능한 시트들:', Object.keys(playerStatsData));
                
                let battingStats = [];
                
                // 정확한 시트명이 없으면 부분 매칭으로 찾기
                let targetSheet = playerStatsData[battingSheetName];
                if (!targetSheet) {
                    console.log('정확한 시트명을 찾을 수 없음, 부분 매칭 시도...');
                    const partialMatches = Object.keys(playerStatsData).filter(sheetName => 
                        sheetName.includes('타자') && 
                        (sheetName.includes('썸머') || sheetName.includes('2025') || sheetName.includes(team.league))
                    );
                    console.log('부분 매칭 시트:', partialMatches);
                    
                    if (partialMatches.length > 0) {
                        targetSheet = playerStatsData[partialMatches[0]];
                        console.log('사용할 시트:', partialMatches[0]);
                    }
                }
                
                if (targetSheet) {
                    const players = targetSheet;
                    console.log('시트의 선수 수:', players.length);
                    console.log('시트의 첫 번째 선수 데이터:', players[0]);
                    
                    // 팀원들의 타자 통계만 필터링
                    teamMembers.forEach(memberName => {
                        const player = players.find(p => p.이름 === memberName);
                        if (player) {
                            console.log(`선수 "${memberName}"의 타자 데이터:`, player);
                            battingStats.push({
                                name: player.이름,
                                atBats: parseInt(player.AB) || 0,
                                hits: parseInt(player.H) || 0,
                                homeRuns: parseInt(player.HR) || 0,
                                stolenBases: parseInt(player.SB) || 0,
                                battingAvg: parseFloat(player.AVG || 0).toFixed(3),
                                onBasePct: parseFloat(player.OBP || 0).toFixed(3),
                                sluggingPct: parseFloat(player.SLG || 0).toFixed(3),
                                wrcPlus: parseFloat(player['wRC+'] || 0).toFixed(1)
                            });
                        } else {
                            console.log(`선수 "${memberName}"을(를) 타자 시트에서 찾을 수 없음`);
                        }
                    });
                } else {
                    console.log('타자 시트를 찾을 수 없습니다');
                    console.log('사용 가능한 시트들:', Object.keys(playerStatsData));
                    console.log('각 시트의 내용 미리보기:');
                    Object.entries(playerStatsData).forEach(([sheetName, data]) => {
                        console.log(`시트 "${sheetName}":`, data.length, '개 행, 첫 번째 행:', data[0]);
                    });
                }
                
                if (battingStats.length === 0) {
                    statsContainer.innerHTML = '<div class="no-data">타자 기록 데이터를 찾을 수 없습니다.</div>';
                    return;
                }
                
                console.log('찾은 타자 통계:', battingStats.length, '명');
                
                // 타자 기록 HTML 생성
                let battingHTML = '';
                
                if (battingStats.length > 0) {
                    battingHTML = `
                        <div class="batting-stats-container">
                            <table class="batting-stats-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="name">선수명</th>
                                        <th class="sortable" data-sort="atBats">타수</th>
                                        <th class="sortable" data-sort="hits">안타</th>
                                        <th class="sortable" data-sort="homeRuns">홈런</th>
                                        <th class="sortable" data-sort="stolenBases">도루</th>
                                        <th class="sortable" data-sort="battingAvg">타율</th>
                                        <th class="sortable" data-sort="onBasePct">출루율</th>
                                        <th class="sortable" data-sort="sluggingPct">장타율</th>
                                        <th class="sortable" data-sort="wrcPlus">wRC+</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${battingStats.map(player => `
                                        <tr>
                                            <td class="player-name">${player.name}</td>
                                            <td>${player.atBats || '-'}</td>
                                            <td>${player.hits || '-'}</td>
                                            <td>${player.homeRuns || '-'}</td>
                                            <td>${player.stolenBases || '-'}</td>
                                            <td>${player.battingAvg || '-'}</td>
                                            <td>${player.onBasePct || '-'}</td>
                                            <td>${player.sluggingPct || '-'}</td>
                                            <td>${player.wrcPlus || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    battingHTML = '<div class="no-data">타자 기록이 없습니다.</div>';
                }
                statsContainer.innerHTML = battingHTML;
                console.log('타자 기록 표시 완료');
                
            } catch (error) {
                console.error('타자 기록 로딩 실패:', error);
                statsContainer.innerHTML = '<div class="error">데이터 로딩 중 오류가 발생했습니다.</div>';
            }
        }

        // 투수 기록을 로드하고 표시하는 함수
        async function loadPitchingStats(teamId) {
            const team = teamsData.find(t => t.id === teamId);
            if (!team) {
                console.error('팀을 찾을 수 없습니다:', teamId);
                return;
            }
            
            console.log('=== 투수 기록 로딩 시작 ===');
            console.log('팀:', team.name, '리그:', team.league);
            console.log('사용 가능한 playerStatsData 키들:', Object.keys(playerStatsData));
            
            const statsContainer = document.getElementById(`pitching-stats-${teamId}`);
            if (!statsContainer) {
                console.error('투수 통계 컨테이너를 찾을 수 없습니다');
                return;
            }
            
            try {
                // League_Team에서 해당 팀의 팀원 목록 찾기
                let teamMembers = [];
                
                if (leagueTeamData[team.league]) {
                    const foundTeam = leagueTeamData[team.league].find(t => 
                        t.name === team.name || 
                        t.abbreviation === team.abbreviation ||
                        t.name.includes(team.name) || 
                        team.name.includes(t.name)
                    );
                    
                    if (foundTeam) {
                        if (foundTeam.members && foundTeam.members.length > 0) {
                            teamMembers = foundTeam.members.map(member => member.name);
                        } else {
                            teamMembers = [team.name]; // 임시로 팀명 사용
                        }
                    } else {
                        teamMembers = [team.name]; // 임시로 팀명 사용
                    }
                } else {
                    teamMembers = [team.name]; // 임시로 팀명 사용
                }
                
                console.log('팀원 목록:', teamMembers);
                
                if (teamMembers.length === 0) {
                    statsContainer.innerHTML = '<div class="no-data">팀원 정보를 찾을 수 없습니다.</div>';
                    return;
                }
                
                // PlayerStatsLeague에서 "(리그이름) 투수" 시트 찾기
                const pitchingSheetName = `${team.league} 투수`;
                console.log('찾는 시트:', pitchingSheetName);
                console.log('사용 가능한 시트들:', Object.keys(playerStatsData));
                
                let pitchingStats = [];
                
                // 정확한 시트명이 없으면 부분 매칭으로 찾기
                let targetSheet = playerStatsData[pitchingSheetName];
                if (!targetSheet) {
                    console.log('정확한 시트명을 찾을 수 없음, 부분 매칭 시도...');
                    const partialMatches = Object.keys(playerStatsData).filter(sheetName => 
                        sheetName.includes('투수') && 
                        (sheetName.includes('썸머') || sheetName.includes('2025') || sheetName.includes(team.league))
                    );
                    console.log('부분 매칭 시트:', partialMatches);
                    
                    if (partialMatches.length > 0) {
                        targetSheet = playerStatsData[partialMatches[0]];
                        console.log('사용할 시트:', partialMatches[0]);
                    }
                }
                
                if (targetSheet) {
                    const players = targetSheet;
                    console.log('시트의 선수 수:', players.length);
                    console.log('시트의 첫 번째 선수 데이터:', players[0]);
                    
                    // 팀원들의 투수 통계만 필터링
                    teamMembers.forEach(memberName => {
                        const player = players.find(p => p.이름 === memberName);
                        if (player) {
                            console.log(`선수 "${memberName}"의 투수 데이터:`, player);
                            pitchingStats.push({
                                name: player.이름,
                                innings: parseFloat(player.IP || 0).toFixed(1),
                                strikeouts: parseInt(player.SO || 0) || 0,
                                walks: parseInt(player.BB || 0) || 0,
                                era: parseFloat(player.ERA || 0).toFixed(2),
                                whip: parseFloat(player.WHIP || 0).toFixed(2),
                                avg: parseFloat(player.AVG || 0).toFixed(3)
                            });
                        } else {
                            console.log(`선수 "${memberName}"을(를) 투수 시트에서 찾을 수 없음`);
                        }
                    });
                } else {
                    console.log('투수 시트를 찾을 수 없습니다');
                    console.log('사용 가능한 시트들:', Object.keys(playerStatsData));
                    console.log('각 시트의 내용 미리보기:');
                    Object.entries(playerStatsData).forEach(([sheetName, data]) => {
                        console.log(`시트 "${sheetName}":`, data.length, '개 행, 첫 번째 행:', data[0]);
                    });
                }
                
                if (pitchingStats.length === 0) {
                    statsContainer.innerHTML = '<div class="no-data">투수 기록 데이터를 찾을 수 없습니다.</div>';
                    return;
                }
                
                console.log('찾은 투수 통계:', pitchingStats.length, '명');
                
                // 투수 기록 HTML 생성
                let pitchingHTML = '';
                
                if (pitchingStats.length > 0) {
                    pitchingHTML = `
                        <div class="pitching-stats-container">
                            <table class="pitching-stats-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-sort="name">선수명</th>
                                        <th class="sortable" data-sort="innings">이닝</th>
                                        <th class="sortable" data-sort="strikeouts">탈삼진</th>
                                        <th class="sortable" data-sort="walks">볼넷</th>
                                        <th class="sortable" data-sort="era">평균자책점</th>
                                        <th class="sortable" data-sort="whip">WHIP</th>
                                        <th class="sortable" data-sort="avg">AVG</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pitchingStats.map(player => `
                                        <tr>
                                            <td class="player-name">${player.name}</td>
                                            <td>${player.innings || '-'}</td>
                                            <td>${player.strikeouts || '-'}</td>
                                            <td>${player.walks || '-'}</td>
                                            <td>${player.era || '-'}</td>
                                            <td>${player.whip || '-'}</td>
                                            <td>${player.avg || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    pitchingHTML = '<div class="no-data">투수 기록이 없습니다.</div>';
                }
                statsContainer.innerHTML = pitchingHTML;
                console.log('투수 기록 표시 완료');
                
            } catch (error) {
                console.error('투수 기록 로딩 실패:', error);
                statsContainer.innerHTML = '<div class="no-data">투수 기록을 불러오는 중 오류가 발생했습니다.</div>';
            }
        }

        // 팀 카드 생성 함수
        function createTeamCard(team) {
            return `
                <div class="team-card ${team.colorClass}" data-team-id="${team.id}">
                    <div class="team-header">
                        <img src="${team.logo}" alt="${team.name}" class="team-logo">
                        <div class="team-info">
                            <div class="team-name">${team.name}</div>
                            <div class="team-years">(${team.years})</div>
                        </div>
                    </div>
                    
                    <div class="team-arrow">›</div>
                </div>
                <div class="team-details" id="details-${team.id}">
                    <div class="info-sections">
                        <div class="info-section">
                            <h3>최근 경기</h3>
                            <div class="recent-games">
                                ${team.details.recentGames && team.details.recentGames.length > 0 ? 
                                    team.details.recentGames.map(game => `
                                    <div class="game-item">
                                        <div class="result-box" style="background-color: ${game.result === 'W' ? '#28a745' : '#dc3545'}">${game.result}</div>
                                        <div class="game-details">
                                            <div class="vs-opponent">vs ${game.opponent}</div>
                                            <div class="score">${game.score}</div>
                                        </div>
                                    </div>
                                `).join('') : 
                                '<div class="no-recent">최근 경기 기록이 없습니다</div>'
                            }
                            </div>
                        </div>
                        
                        <div class="info-section">
                            <h3>다음 경기</h3>
                            <div class="next-games">
                                ${team.details.nextGames && team.details.nextGames.length > 0 ? 
                                    team.details.nextGames.map(game => `
                                        <div class="next-game">
                                            <div class="next-game-item">
                                                <div class="next-game-header">vs ${game.opponent}</div>
                                                <div class="next-game-venue">${game.isHome ? '홈' : '원정'}</div>
                                                <div class="next-game-details">
                                                    <div class="next-game-date">${game.date}</div>
                                                    <div class="next-game-time">${game.time}</div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('') : 
                                    '<div class="no-next-game">다음 경기 일정이 없습니다</div>'
                                }
                            </div>
                        </div>
                        
                        <div class="info-section">
                            <h3>상대 전적</h3>
                            <div class="head-to-head">
                                ${Object.entries(team.details.headToHead).map(([opponent, stats]) => {
                                    // 상대팀 이름을 더 정확하게 표시
                                    let opponentDisplayName = opponent;
                                    if (opponent === 'ishikawa') opponentDisplayName = 'Ishikawa';
                                    else if (opponent === 'nyanko') opponentDisplayName = 'Nyanko';
                                    else if (opponent === 'leroleros') opponentDisplayName = 'Leroleros';
                                    else if (opponent === 'florian') opponentDisplayName = 'Florian';
                                    else if (opponent === 'bubble') opponentDisplayName = 'Bubble';
                                    
                                    return `
                                        <div class="h2h-item">
                                            <span class="opponent">${opponentDisplayName}</span>
                                            <span class="record">${stats.wins}-${stats.losses}</span>
                                            <span class="win-rate">${stats.winRate}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3>타자 기록</h3>
                        <div class="player-stats" id="batting-stats-${team.id}">
                            <div class="loading">데이터를 불러오는 중...</div>
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <h3>투수 기록</h3>
                        <div class="player-stats" id="pitching-stats-${team.id}">
                            <div class="loading">데이터를 불러오는 중...</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 팀 카드들 렌더링
        function renderTeams() {
            const container = document.getElementById('teams-container');
            container.innerHTML = teamsData.map(team => createTeamCard(team)).join('');
        }

        // 필터링 함수
        function filterTeams() {
            const teamFilter = document.getElementById('team-filter').value;
            const overallFilter = document.getElementById('overall-filter').value;
            
            let filteredTeams = [...teamsData];
            
            // 팀별 필터링
            if (teamFilter !== 'all') {
                filteredTeams = filteredTeams.filter(team => team.id === teamFilter);
            }
            
            // 정렬
            if (overallFilter === 'name') {
                filteredTeams.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            const container = document.getElementById('teams-container');
            container.innerHTML = filteredTeams.map(team => createTeamCard(team)).join('');
        }

        // 테이블 정렬 함수들
        function sortTable(table, columnIndex, sortType) {
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const header = table.querySelectorAll('th[data-sort]')[columnIndex];
            
            // 모든 헤더의 정렬 상태 초기화
            table.querySelectorAll('th[data-sort]').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            // 현재 헤더에 정렬 상태 표시
            if (sortType === 'asc') {
                header.classList.add('sort-asc');
            } else {
                header.classList.add('sort-desc');
            }
            
            // 행 정렬
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                // 숫자 정렬 (첫 번째 컬럼 제외)
                if (columnIndex > 0) {
                    const aNum = parseFloat(aValue) || 0;
                    const bNum = parseFloat(bValue) || 0;
                    
                    if (sortType === 'asc') {
                        return aNum - bNum;
                    } else {
                        return bNum - aNum;
                    }
                } else {
                    // 문자열 정렬 (첫 번째 컬럼)
                    if (sortType === 'asc') {
                        return aValue.localeCompare(bValue, 'ko');
                    } else {
                        return bValue.localeCompare(aValue, 'ko');
                    }
                }
            });
            
            // 정렬된 행을 테이블에 다시 추가
            rows.forEach(row => tbody.appendChild(row));
        }

        // 테이블 헤더 클릭 이벤트 처리
        function setupTableSorting() {
            document.addEventListener('click', function(e) {
                if (e.target.matches('th[data-sort]')) {
                    const table = e.target.closest('table');
                    const columnIndex = Array.from(e.target.parentElement.children).indexOf(e.target);
                    const currentSort = e.target.classList.contains('sort-asc') ? 'desc' : 'asc';
                    
                    sortTable(table, columnIndex, currentSort);
                }
            });
        }

        // 데이터 로드 및 초기화
        async function initializeData() {
            try {
                // League_Team, PlayerStatsLeague, Schedule.csv 데이터 로드
                await Promise.all([
                    loadLeagueTeamData(),
                    loadPlayerStatsData(),
                    loadScheduleData()
                ]);
                
                // 팀 데이터 생성
                teamsData = generateTeamsData();
                
                // 팀 렌더링
                renderTeams();
                
                // 테이블 정렬 기능 설정
                setupTableSorting();
                
                console.log('팀 데이터 초기화 완료:', teamsData);
                console.log('League_Team 데이터:', leagueTeamData);
                console.log('PlayerStatsLeague 데이터:', playerStatsData);
                console.log('Schedule.csv 데이터:', scheduleData);
                
                // 데이터 상태 상세 확인
                checkDataStatus();
                
            } catch (error) {
                console.error('데이터 초기화 실패:', error);
                // 에러 발생 시 기본 데이터로 렌더링
                teamsData = generateTeamsData();
                renderTeams();
                setupTableSorting();
                checkDataStatus();
            }
        }

        // 데이터 상태 확인 함수 (디버깅용)
        function checkDataStatus() {
            console.log('=== 데이터 상태 확인 ===');
            console.log('teamsData:', teamsData);
            console.log('leagueTeamData:', leagueTeamData);
            console.log('playerStatsData:', playerStatsData);
            console.log('scheduleData:', scheduleData);
            
            if (teamsData.length > 0) {
                console.log('첫 번째 팀:', teamsData[0]);
                console.log('첫 번째 팀의 리그:', teamsData[0].league);
                console.log('첫 번째 팀의 최근 경기:', teamsData[0].details.recentGames);
                console.log('첫 번째 팀의 다음 경기:', teamsData[0].details.nextGames);
                console.log('첫 번째 팀의 상대 전적:', teamsData[0].details.headToHead);
            }
            
            // 오늘 날짜 확인
            const today = new Date();
            console.log('오늘 날짜:', today.toISOString().split('T')[0]);
        }

        // 이벤트 리스너 등록
        document.addEventListener('DOMContentLoaded', function() {
            // 데이터 초기화
            initializeData();
            
            document.getElementById('team-filter').addEventListener('change', filterTeams);
            document.getElementById('overall-filter').addEventListener('change', filterTeams);
            
            // 팀 카드 클릭 이벤트 처리
            document.addEventListener('click', function(e) {
                const teamCard = e.target.closest('.team-card');
                if (teamCard) {
                    const teamId = teamCard.dataset.teamId;
                    const detailsElement = document.getElementById(`details-${teamId}`);
                    
                    if (detailsElement) {
                        const isExpanded = teamCard.classList.contains('expanded');
                        
                        if (isExpanded) {
                            teamCard.classList.remove('expanded');
                            detailsElement.classList.remove('show');
                        } else {
                            teamCard.classList.add('expanded');
                            detailsElement.classList.add('show');
                            // 타자 기록 로드
                            loadBattingStats(teamId);
                            // 투수 기록 로드
                            loadPitchingStats(teamId);
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>